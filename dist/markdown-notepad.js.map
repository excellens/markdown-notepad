{"version":3,"file":"markdown-notepad.js","sources":["../src/MarkdownNotepad/Base.js","../src/MarkdownNotepad/State.js","../src/MarkdownNotepad/Component/Textarea.js","../src/MarkdownNotepad/Component/Tab.js","../src/MarkdownNotepad/Theme.js","../src/MarkdownNotepad/Component/TabPane.js","../src/MarkdownNotepad/Component/Button.js","../src/MarkdownNotepad/Component/Preview.js","../src/MarkdownNotepad/Service/Engine.js","../src/MarkdownNotepad/Service/Action/Snapshot/Transaction.js","../src/MarkdownNotepad/Service/Action/Snapshot.js","../src/MarkdownNotepad/Service/Action.js","../src/MarkdownNotepad/Service/Collection.js","../src/MarkdownNotepad/Configuration.js","../src/MarkdownNotepad/Control/MarkdownNotepad.js","../src/Main.js"],"sourcesContent":["/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\n/**\r\n * @param {ParentNode} node\r\n * @param {string} selector\r\n */\r\nexport function FindOne(node, selector) {\r\n    let element = node.querySelector(selector);\r\n\r\n    if (null === element) {\r\n        throw 'ERR_FIND_ONE';\r\n    }\r\n\r\n    return element;\r\n}\r\n\r\n/**\r\n * @param {ParentNode} node\r\n * @param {string} selector\r\n */\r\nexport function FindAll(node, selector) {\r\n    let elementList = node.querySelectorAll(selector);\r\n\r\n    if (false === !!elementList.length) {\r\n        throw 'ERR_FIND_ALL';\r\n    }\r\n\r\n    return elementList;\r\n}\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as Elementary from '@excellens/elementary'\r\n\r\nexport function SelectionState() {\r\n    const self = new Elementary.Component.ComponentState();\r\n\r\n    this.start = 0;\r\n\r\n    this.getStart = function () {\r\n        return this.start;\r\n    };\r\n    this.setStart = function (start) {\r\n        this.start = start;\r\n\r\n        return this;\r\n    };\r\n\r\n    this.end = 0;\r\n\r\n    this.getEnd = function () {\r\n        return this.end;\r\n    };\r\n    this.setEnd = function (end) {\r\n        this.end = end;\r\n\r\n        return this;\r\n    };\r\n\r\n    this.direction = 'none';\r\n\r\n    this.getDirection = function () {\r\n        return this.direction;\r\n    };\r\n    this.setDirection = function (direction) {\r\n        this.direction = direction;\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as Elementary from '@excellens/elementary'\r\nimport {SelectionState} from \"../State\";\r\n\r\nexport function Textarea(document, element, state) {\r\n    const self = (function (document, element, state) {\r\n        const presenter = new TextareaPresenter(state);\r\n        return new Elementary.Component.Component(presenter, document, 'textarea', element);\r\n    }(document, element, state || new TextareaState()));\r\n    const parent = {\r\n        initialize: self.initialize,\r\n        destroy: self.destroy,\r\n    };\r\n\r\n    let eventChange = null;\r\n    let eventKeyUp = null;\r\n\r\n    let eventSelectionChange = null;\r\n\r\n    const changeSelection = function () {\r\n        const start = self.selectionStart;\r\n        const end = self.selectionEnd;\r\n\r\n        const direction = self.selectionDirection;\r\n\r\n        self.presenter.changeSelection(start, end, direction);\r\n    };\r\n\r\n    this.initialize = function () {\r\n        parent.initialize();\r\n\r\n        self.addEventListener('change', eventChange = function (event) {\r\n            changeSelection();\r\n\r\n            self.presenter.changeValue(self.value);\r\n        });\r\n        self.addEventListener('keyup', eventKeyUp = function (event) {\r\n            changeSelection();\r\n\r\n            self.presenter.changeValue(self.value);\r\n        });\r\n\r\n        document.addEventListener('selectionchange', eventSelectionChange = function (event) {\r\n            if (document.activeElement === self) {\r\n                changeSelection();\r\n            }\r\n        });\r\n\r\n        return this;\r\n    };\r\n\r\n    this.setValue = function (value) {\r\n        self.value = value;\r\n\r\n        return this;\r\n    };\r\n\r\n    this.setSelection = function (start, end, direction) {\r\n        self.selectionStart = start;\r\n        self.selectionEnd = end;\r\n\r\n        self.selectionDirection = direction;\r\n\r\n        return this;\r\n    };\r\n\r\n    this.destroy = function () {\r\n        parent.destroy();\r\n\r\n        self.removeEventListener('change', eventChange);\r\n        eventChange = null;\r\n        self.removeEventListener('keyup', eventKeyUp);\r\n        eventKeyUp = null;\r\n\r\n        document.removeEventListener('selectionchange', eventSelectionChange);\r\n        eventSelectionChange = null;\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function TextareaPresenter(state) {\r\n    const self = new Elementary.Component.ComponentPresenter(state);\r\n    const parent = {\r\n        initialize: self.initialize,\r\n        destroy: self.destroy,\r\n    };\r\n\r\n    this.update = function (state, id) {\r\n        self.component.setValue(state.getValue());\r\n\r\n        if (state.hasSelection()) {\r\n            const selection = state.getSelection();\r\n\r\n            const start = selection.getStart();\r\n            const end = selection.getEnd();\r\n\r\n            const direction = selection.getDirection();\r\n\r\n            self.component.setSelection(start, end, direction);\r\n        }\r\n    };\r\n\r\n    this.initialize = function (component) {\r\n        this.initializeState();\r\n\r\n        parent.initialize(component);\r\n\r\n        return this;\r\n    };\r\n\r\n    this.initializeState = function () {\r\n        if (!self.state.hasSelection()) {\r\n            const selection = new SelectionState();\r\n\r\n            self.state.setSelection(selection);\r\n        }\r\n\r\n        return this;\r\n    };\r\n\r\n    this.changeValue = function (value) {\r\n        if (self.state.getValue() !== value) {\r\n            self.state.setValue(value);\r\n            self.state.notify();\r\n        }\r\n\r\n        return this;\r\n    };\r\n\r\n    this.changeSelection = function (start, end, direction) {\r\n        if (self.state.hasSelection()) {\r\n            const selection = self.state.getSelection();\r\n\r\n            selection.setStart(start);\r\n            selection.setEnd(end);\r\n\r\n            selection.setDirection(direction);\r\n            selection.notify();\r\n        }\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function TextareaState() {\r\n    const self = new Elementary.Component.ComponentState();\r\n\r\n    this.value = '';\r\n\r\n    this.getValue = function () {\r\n        return this.value;\r\n    };\r\n    this.setValue = function (value) {\r\n        this.value = value;\r\n\r\n        return this;\r\n    };\r\n\r\n    this.selection = null;\r\n\r\n    this.getSelection = function () {\r\n        return this.selection;\r\n    };\r\n    this.setSelection = function (selection) {\r\n        this.selection = selection;\r\n\r\n        return this;\r\n    };\r\n    this.hasSelection = function () {\r\n        return !!this.selection;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as Elementary from '@excellens/elementary'\r\n\r\nexport function Tab(document, element, state) {\r\n    const self = (function (document, element, state) {\r\n        const presenter = new TabPresenter(state);\r\n        return new Elementary.Component.Component(presenter, document, 'div', element);\r\n    }(document, element, state || new TabState()));\r\n    const parent = {\r\n        initialize: self.initialize,\r\n        destroy: self.destroy,\r\n    };\r\n\r\n    let eventClick = null;\r\n\r\n    this.initialize = function () {\r\n        parent.initialize();\r\n\r\n        self.addEventListener('click', eventClick = function (event) {\r\n            self.presenter.changeActive(true);\r\n        });\r\n\r\n        return this;\r\n    };\r\n\r\n    this.setActive = function (active) {\r\n        self.classList.toggle('active', active);\r\n\r\n        return this;\r\n    };\r\n\r\n    this.destroy = function () {\r\n        parent.destroy();\r\n\r\n        self.removeEventListener('click', eventClick);\r\n        eventClick = null;\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function TabPresenter(state) {\r\n    const self = new Elementary.Component.ComponentPresenter(state);\r\n    const parent = {\r\n        initialize: self.initialize,\r\n        destroy: self.destroy,\r\n    };\r\n\r\n    this.update = function (state, id) {\r\n        self.component.setActive(state.isActive());\r\n\r\n        if (state.hasPane()) {\r\n            let paneState = state.getPane();\r\n            paneState.setActive(state.isActive());\r\n            paneState.notify();\r\n        }\r\n    };\r\n\r\n    this.changeActive = function (active) {\r\n        self.state.setActive(active);\r\n        self.state.notify();\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function TabState() {\r\n    const self = new Elementary.Component.ComponentState();\r\n\r\n    this.name = 'tab';\r\n\r\n    this.getName = function () {\r\n        return this.name;\r\n    };\r\n    this.setName = function (name) {\r\n        this.name = name;\r\n        return this;\r\n    };\r\n\r\n    this.active = false;\r\n\r\n    this.isActive = function () {\r\n        return this.active;\r\n    };\r\n    this.setActive = function (active) {\r\n        this.active = active;\r\n        return this;\r\n    };\r\n\r\n    this.pane = null;\r\n\r\n    this.getPane = function () {\r\n        return this.pane;\r\n    };\r\n    this.setPane = function (pane) {\r\n        this.pane = pane;\r\n        return this;\r\n    };\r\n    this.hasPane = function () {\r\n        return !!this.pane;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as Elementary from '@excellens/elementary'\r\nimport {FindOne} from \"./Base\";\r\n\r\nexport function Theme(document, id) {\r\n    const self = {};\r\n\r\n    this.id = id;\r\n\r\n    this.template = null;\r\n\r\n    this.initialize = function (control) {\r\n        this.initializeTemplate();\r\n\r\n        control.innerHTML = this.template;\r\n\r\n        const id = this.id;\r\n        control.classList.add(`theme-${id}`);\r\n\r\n        return this;\r\n    };\r\n\r\n    this.initializeTemplate = function () {\r\n        const id = this.id;\r\n\r\n        const templateElement = FindOne(document, `script[type=\"theme/markdown-notepad\"]#${id}`);\r\n        this.template = templateElement.innerHTML;\r\n\r\n        return this;\r\n    };\r\n\r\n    this.destroy = function () {\r\n        this.template = null;\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as Elementary from '@excellens/elementary'\r\n\r\nexport function TabPane(document, element, state) {\r\n    const self = (function (document, element, state) {\r\n        const presenter = new TabPanePresenter(state);\r\n        return new Elementary.Component.Component(presenter, document, 'div', element);\r\n    }(document, element, state || new TabPaneState()));\r\n    const parent = {\r\n        initialize: self.initialize,\r\n        destroy: self.destroy,\r\n    };\r\n\r\n    this.setActive = function (active) {\r\n        self.classList.toggle('active', active);\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function TabPanePresenter(state) {\r\n    const self = new Elementary.Component.ComponentPresenter(state);\r\n    const parent = {\r\n        initialize: self.initialize,\r\n        destroy: self.destroy,\r\n    };\r\n\r\n    this.update = function (state, id) {\r\n        self.component.setActive(state.isActive());\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function TabPaneState() {\r\n    const self = new Elementary.Component.ComponentState();\r\n\r\n    this.name = 'tab-pane';\r\n\r\n    this.getName = function () {\r\n        return this.name;\r\n    };\r\n    this.setName = function (name) {\r\n        this.name = name;\r\n        return this;\r\n    };\r\n\r\n    this.active = false;\r\n\r\n    this.isActive = function () {\r\n        return this.active;\r\n    };\r\n    this.setActive = function (active) {\r\n        this.active = active;\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as Elementary from '@excellens/elementary'\r\n\r\nexport function Button(document, element, state) {\r\n    const self = (function (document, element, state) {\r\n        const presenter = new ButtonPresenter(state);\r\n        return new Elementary.Component.Component(presenter, document, 'button', element);\r\n    }(document, element, state || new ButtonState()));\r\n    const parent = {\r\n        initialize: self.initialize,\r\n        destroy: self.destroy,\r\n    };\r\n\r\n    let eventMouseDown = null;\r\n    let eventMouseUp = null;\r\n\r\n    this.initialize = function () {\r\n        parent.initialize();\r\n\r\n        self.addEventListener('mousedown', eventMouseDown = function (event) {\r\n            self.presenter.changeClick(true);\r\n        });\r\n        self.addEventListener('mouseup', eventMouseUp = function (event) {\r\n            self.presenter.changeClick(false);\r\n        });\r\n\r\n        return this;\r\n    };\r\n\r\n    this.setActive = function (active) {\r\n        self.classList.toggle('active', active);\r\n\r\n        return this;\r\n    };\r\n\r\n    this.destroy = function () {\r\n        parent.destroy();\r\n\r\n        self.removeEventListener('mousedown', eventMouseDown);\r\n        eventMouseDown = null;\r\n        self.removeEventListener('mouseup', eventMouseUp);\r\n        eventMouseUp = null;\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function ButtonPresenter(state) {\r\n    const self = new Elementary.Component.ComponentPresenter(state);\r\n    const parent = {\r\n        initialize: self.initialize,\r\n        destroy: self.destroy,\r\n    };\r\n\r\n    this.update = function (state, id) {\r\n        self.component.setActive(state.isActive());\r\n    };\r\n\r\n    this.changeClick = function (click) {\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function ButtonState() {\r\n    const self = new Elementary.Component.ComponentState();\r\n\r\n    this.name = 'button';\r\n\r\n    this.getName = function () {\r\n        return this.name;\r\n    };\r\n    this.setName = function (name) {\r\n        this.name = name;\r\n        return this;\r\n    };\r\n\r\n    this.active = false;\r\n\r\n    this.isActive = function () {\r\n        return this.active;\r\n    };\r\n    this.setActive = function (active) {\r\n        this.active = active;\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as Elementary from '@excellens/elementary'\r\n\r\nexport function Preview(document, element, state) {\r\n    const self = (function (document, element, state) {\r\n        const presenter = new PreviewPresenter(state);\r\n        return new Elementary.Component.Component(presenter, document, 'div', element);\r\n    }(document, element, state || new PreviewState()));\r\n    const parent = {\r\n        initialize: self.initialize,\r\n        destroy: self.destroy,\r\n    };\r\n\r\n    this.setValue = function (value) {\r\n        self.innerHTML = value;\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function PreviewPresenter(state) {\r\n    const self = new Elementary.Component.ComponentPresenter(state);\r\n    const parent = {\r\n        initialize: self.initialize,\r\n        destroy: self.destroy,\r\n    };\r\n\r\n    this.update = function (state, id) {\r\n        self.component.setValue(state.getValue());\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function PreviewState() {\r\n    const self = new Elementary.Component.ComponentState();\r\n\r\n    this.value = '';\r\n\r\n    this.getValue = function () {\r\n        return this.value;\r\n    };\r\n    this.setValue = function (value) {\r\n        this.value = value;\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as Elementary from '@excellens/elementary'\r\nimport * as MarkdownNotepadPack from '@excellens/markdown-notepad-pack'\r\n\r\nexport function Engine() {\r\n    const self = {};\r\n\r\n    this.process = function (value) {\r\n        throw 'ERR_ENGINE_PROCESS';\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function EngineMd() {\r\n    const self = new Engine();\r\n\r\n    this.md = new MarkdownNotepadPack.Instance();\r\n\r\n    this.process = function (value) {\r\n        return this.md.render(value);\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as Elementary from '@excellens/elementary'\r\n\r\nexport function Transaction() {\r\n    const self = {};\r\n\r\n    this.commit = function (snapshot, state) {\r\n        throw 'ERR_TRANSACTION_COMMIT';\r\n    };\r\n\r\n    this.rollback = function (snapshot, state) {\r\n        throw 'ERR_TRANSACTION_ROLLBACK';\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function TextareaTransaction() {\r\n    const self = new Transaction();\r\n\r\n    this.commit = function (snapshot, state) {\r\n        state.setValue(snapshot.getValue());\r\n\r\n        if (state.hasSelection()) {\r\n            this.commitSelection(snapshot, state.getSelection());\r\n        }\r\n\r\n        state.notify();\r\n\r\n        return this;\r\n    };\r\n\r\n    this.commitSelection = function (snapshot, state) {\r\n        state.setStart(\r\n            snapshot.start\r\n        );\r\n        state.setEnd(\r\n            snapshot.end\r\n        );\r\n\r\n        state.notify();\r\n\r\n        return this;\r\n    };\r\n\r\n    this.rollback = function (snapshot, state) {\r\n        const value = state.getValue();\r\n\r\n        if (state.hasSelection()) {\r\n            this.rollbackSelection(snapshot, state.getSelection());\r\n        } else {\r\n            snapshot.start /**/ = value.length;\r\n            snapshot.end /****/ = value.length;\r\n        }\r\n\r\n        snapshot.before /*****/ = value.substring(\r\n            undefined,\r\n            snapshot.start\r\n        );\r\n        snapshot.inside /*****/ = value.substring(\r\n            snapshot.start,\r\n            snapshot.end\r\n        );\r\n        snapshot.after /******/ = value.substring(\r\n            snapshot.end,\r\n            undefined\r\n        );\r\n\r\n        return this;\r\n    };\r\n\r\n    this.rollbackSelection = function (snapshot, state) {\r\n        snapshot.start /**/ = state.getStart();\r\n        snapshot.end /****/ = state.getEnd();\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as Elementary from '@excellens/elementary'\r\n\r\nexport function Snapshot() {\r\n    const self = {};\r\n\r\n    this.state = null;\r\n\r\n    this.initialize = function () {\r\n        if (false === !!this.state) {\r\n            throw 'ERR_SNAPSHOT_INITIALIZE';\r\n        }\r\n\r\n        this.rollback();\r\n\r\n        return this;\r\n    };\r\n\r\n    this.attach = function (state) {\r\n        this.state = state;\r\n\r\n        return this;\r\n    };\r\n    this.detach = function () {\r\n        this.state = null;\r\n\r\n        return this;\r\n    };\r\n\r\n    this.rollback = function () {\r\n        throw 'ERR_SNAPSHOT_ROLLBACK';\r\n    };\r\n\r\n    this.commit = function () {\r\n        throw 'ERR_SNAPSHOT_COMMIT';\r\n    };\r\n\r\n    this.destroy = function () {\r\n        if (true === !!this.state) {\r\n            throw 'ERR_SNAPSHOT_DESTROY';\r\n        }\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function TextSnapshot(transaction) {\r\n    const self = new Snapshot();\r\n    const parent = {\r\n        initialize: self.initialize,\r\n        destroy: self.destroy,\r\n    };\r\n\r\n    // Handle state only in transaction.\r\n    this.transaction = transaction;\r\n\r\n    this.start /******/ = 0;\r\n    this.end /********/ = 0;\r\n\r\n    this.before /*****/ = null;\r\n    this.inside /*****/ = null;\r\n    this.after /******/ = null;\r\n\r\n    this.getValue = function () {\r\n        return this.before + this.inside + this.after;\r\n    };\r\n\r\n    this.initialize = function (state) {\r\n        self.attach(state);\r\n\r\n        return parent.initialize();\r\n    };\r\n\r\n    this.commit = function () {\r\n        this.transaction.commit(this, self.state);\r\n\r\n        return this;\r\n    };\r\n\r\n    this.rollback = function () {\r\n        this.transaction.rollback(this, self.state);\r\n\r\n        return this;\r\n    };\r\n\r\n    this.destroy = function () {\r\n        self.detach();\r\n\r\n        this.start /******/ = 0;\r\n        this.end /********/ = 0;\r\n\r\n        this.before /*****/ = null;\r\n        this.inside /*****/ = null;\r\n        this.after /******/ = null;\r\n\r\n        return parent.destroy();\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport * as Transaction from './Snapshot/Transaction'\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as Elementary from '@excellens/elementary'\r\nimport {TextSnapshot} from \"./Action/Snapshot\";\r\nimport {TextareaTransaction} from \"./Action/Snapshot/Transaction\";\r\n\r\nexport function Action(handle) {\r\n    const self = {};\r\n\r\n    if (true === !!handle) {\r\n        this.handle = handle;\r\n    } else {\r\n        this.handle = function (state) {\r\n            throw 'ERR_ACTION_HANDLE';\r\n        };\r\n    }\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nAction.registry = new Elementary.Collection.CollectionMap();\r\n\r\nexport function ActionTab(name) {\r\n    const self = new Action(null);\r\n\r\n    this.name = name;\r\n\r\n    this.handle = function (state) {\r\n        if (state.tab.has(this.name)) {\r\n            const tab = state.tab.get(this.name);\r\n            tab.setActive(true);\r\n            tab.notify();\r\n        }\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function ActionTabWrite() {\r\n    const self = new ActionTab('write');\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nAction.registry.add('tab-write', new ActionTabWrite());\r\n\r\nexport function ActionTabPreview() {\r\n    const self = new ActionTab('preview');\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nAction.registry.add('tab-preview', new ActionTabPreview());\r\n\r\nexport function ActionHistory() {\r\n    const self = new Action(null);\r\n\r\n    this.handle = function (state) {\r\n        this.change(state.history);\r\n        return this.update(state.history, state);\r\n    };\r\n\r\n    this.change = function (history) {\r\n        throw 'ERR_ACTION_HISTORY_CHANGE';\r\n    };\r\n\r\n    this.update = function (history, state) {\r\n        if (history.hasCurrent() && state.hasTextarea()) {\r\n            const current = history.getCurrent();\r\n\r\n            // The transaction has to support the textarea state.\r\n            current.attach(state.getTextarea());\r\n            current.commit();\r\n            current.detach();\r\n        }\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function ActionHistoryForward() {\r\n    const self = new ActionHistory();\r\n\r\n    this.change = function (history) {\r\n        history.moveForward();\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nAction.registry.add('history-forward', new ActionHistoryForward());\r\n\r\nexport function ActionHistoryBackward() {\r\n    const self = new ActionHistory();\r\n\r\n    this.change = function (history) {\r\n        history.moveBackward();\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nAction.registry.add('history-backward', new ActionHistoryBackward());\r\n\r\nexport function ActionText() {\r\n    const self = new Action(null);\r\n\r\n    const text = new TextSnapshot(\r\n        new TextareaTransaction()\r\n    );\r\n\r\n    this.handle = function (state) {\r\n        if (state.hasTextarea()) {\r\n            text.initialize(state.getTextarea());\r\n\r\n            if (!this.check(state, text)) {\r\n                this.insert(state, text);\r\n            } else {\r\n                this.delete(state, text);\r\n            }\r\n            text.commit();\r\n\r\n            text.destroy();\r\n        }\r\n\r\n        return this;\r\n    };\r\n\r\n    this.check = function (state, text) {\r\n        throw 'ERR_ACTION_TEXT_CHECK';\r\n    };\r\n\r\n    this.insert = function (state, text) {\r\n        throw 'ERR_ACTION_TEXT_INSERT';\r\n    };\r\n    this.delete = function (state, text) {\r\n        throw 'ERR_ACTION_TEXT_DELETE';\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function ActionTextWrap(prefix, suffix) {\r\n    const self = new ActionText();\r\n    const parent = {\r\n        insert: self.insert,\r\n        delete: self.delete,\r\n    };\r\n\r\n    this.prefix = prefix;\r\n    this.suffix = suffix;\r\n\r\n    this.check = function (state, text) {\r\n        return text.before.endsWith(self.prefix)\r\n            && text.after.startsWith(self.suffix);\r\n    };\r\n\r\n    this.insert = function (state, text) {\r\n        text.before = text.before + this.prefix;\r\n        text.after = this.suffix + text.after;\r\n\r\n        text.start = text.start + this.prefix.length;\r\n        text.end = text.end + this.prefix.length;\r\n\r\n        return this;\r\n    };\r\n\r\n    this.delete = function (state, text) {\r\n        text.before = text.before.substring(undefined, text.before.length - this.prefix.length);\r\n        text.after = text.after.substring(undefined, text.after.length - this.suffix.length);\r\n\r\n        text.start = text.start - this.prefix.length;\r\n        text.end = text.end - this.prefix.length;\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function ActionTextPrefix(prefix) {\r\n    const self = new ActionTextWrap(prefix, '');\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function ActionTextPrefixLine(prefix) {\r\n    const self = new ActionTextPrefix(prefix);\r\n    const parent = {\r\n        insert: self.insert,\r\n        delete: self.delete,\r\n    };\r\n\r\n    this.insert = function (state, text) {\r\n        const line = '\\n';\r\n\r\n        if (0 < text.before.length && !text.before.endsWith(line)) {\r\n            text.before = text.before + line;\r\n\r\n            text.start = text.start + line.length;\r\n            text.end = text.end + line.length;\r\n        }\r\n\r\n        return parent.insert(state, text);\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function ActionTextHeadline() {\r\n    const self = new ActionTextPrefix('### ');\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nAction.registry.add('text-headline', new ActionTextHeadline());\r\n\r\nexport function ActionTextBold() {\r\n    const self = new ActionTextWrap('**', '**');\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nAction.registry.add('text-bold', new ActionTextBold());\r\n\r\nexport function ActionTextItalic() {\r\n    const self = new ActionTextWrap('_', '_');\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nAction.registry.add('text-italic', new ActionTextItalic());\r\n\r\nexport function ActionTextQuote() {\r\n    const self = new ActionTextPrefixLine('> ');\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nAction.registry.add('text-quote', new ActionTextQuote());\r\n\r\nexport function ActionTextCode() {\r\n    const self = new ActionTextWrap('`', '`');\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nAction.registry.add('text-code', new ActionTextCode());\r\n\r\nexport function ActionTextLink() {\r\n    const self = new ActionTextWrap('[', ']');\r\n    const parent = {\r\n        insert: self.insert,\r\n        delete: self.delete,\r\n    };\r\n\r\n    this.check = function (state, text) {\r\n        return false;\r\n    };\r\n\r\n    this.insert = function (state, text) {\r\n        const line = '(url)';\r\n\r\n        text.after = line + text.after;\r\n\r\n        if (0 < text.inside.length) {\r\n            text.start = text.end + self.suffix.length + '('.length;\r\n            text.end = text.end + self.suffix.length + '('.length + 'url'.length;\r\n        }\r\n\r\n        return parent.insert(state, text);\r\n    };\r\n\r\n    this.delete = function (state, text) {\r\n        return parent.delete(state, text);\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\nAction.registry.add('text-link', new ActionTextLink());\r\n\r\nexport function ActionTextUl() {\r\n    const self = new ActionTextPrefixLine('- ');\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nAction.registry.add('text-ul', new ActionTextUl());\r\n\r\nexport function ActionTextOl() {\r\n    const self = new ActionTextPrefixLine('1. ');\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nAction.registry.add('text-ol', new ActionTextOl());\r\n\r\nexport * as Snapshot from './Action/Snapshot'\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as Elementary from '@excellens/elementary'\r\n\r\nexport function History() {\r\n    const self = new Elementary.Collection.Collection();\r\n    const parent = {\r\n        add: self.add,\r\n    };\r\n\r\n    this.index = 0;\r\n\r\n    this.getIndex = function () {\r\n        return this.index;\r\n    };\r\n    this.setIndex = function (index) {\r\n        if (0 > index) {\r\n            index = 0;\r\n        }\r\n\r\n        const size = self.size();\r\n        if (index >= size) {\r\n            index = size - 1;\r\n        }\r\n\r\n        this.index = index;\r\n\r\n        return this;\r\n    };\r\n\r\n    this.modifyIndex = function (by) {\r\n        this.setIndex(\r\n            this.getIndex() + by\r\n        );\r\n\r\n        return this;\r\n    };\r\n\r\n    this.moveForward = function () {\r\n        return this.modifyIndex(+1);\r\n    };\r\n    this.moveBackward = function () {\r\n        return this.modifyIndex(-1);\r\n    };\r\n\r\n    this.getCurrent = function () {\r\n        return self.get(\r\n            this.getIndex()\r\n        );\r\n    };\r\n    this.hasCurrent = function () {\r\n        return self.has(\r\n            this.getIndex()\r\n        );\r\n    };\r\n\r\n    this.add = function (index, value) {\r\n        // Remove the loose end of the list if we are behind.\r\n        while (this.getIndex() < self.size() - 1) {\r\n            self.pop();\r\n        }\r\n\r\n        return parent.add(index, value);\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as Elementary from '@excellens/elementary'\r\n\r\nexport function Configuration() {\r\n    const self = {};\r\n\r\n    this.theme = 'default';\r\n\r\n    this.getTheme = function () {\r\n        return this.theme;\r\n    };\r\n    this.setTheme = function (theme) {\r\n        this.theme = theme;\r\n        return this;\r\n    };\r\n\r\n    this.tab = new Elementary.Collection.Collection();\r\n\r\n    this.button = new Elementary.Collection.CollectionMap();\r\n\r\n    this.key = new Elementary.Collection.CollectionMap();\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as Elementary from '@excellens/elementary'\r\nimport {Theme} from \"../Theme\";\r\nimport {FindOne} from \"../Base\";\r\nimport {Tab, TabState} from \"../Component/Tab\";\r\nimport {TabPane, TabPaneState} from \"../Component/TabPane\";\r\nimport {Button, ButtonState} from \"../Component/Button\";\r\nimport {Textarea, TextareaState} from \"../Component/Textarea\";\r\nimport {Preview, PreviewState} from \"../Component/Preview\";\r\nimport {EngineMd} from \"../Service/Engine\";\r\nimport {TextSnapshot} from \"../Service/Action/Snapshot\";\r\nimport {Action} from \"../Service/Action\";\r\nimport {History} from \"../Service/Collection\";\r\nimport {TextareaTransaction} from \"../Service/Action/Snapshot/Transaction\";\r\nimport {Configuration} from \"../Configuration\";\r\n\r\nexport function MarkdownNotepad(document, element, state) {\r\n    const self = (function (document, element, state) {\r\n        const presenter = new MarkdownNotepadPresenter(state);\r\n        return new Elementary.Component.Component(presenter, document, 'div', element);\r\n    }(document, element, state || new MarkdownNotepadState()));\r\n    const parent = {\r\n        initialize: self.initialize,\r\n        destroy: self.destroy,\r\n    };\r\n\r\n    this.theme = null;\r\n\r\n    this.tab = new Elementary.Collection.CollectionMap();\r\n    this.tabPane = new Elementary.Collection.CollectionMap();\r\n\r\n    let eventKeyDown = null;\r\n    let eventKeyUp = null;\r\n    let eventContextMenu = null;\r\n\r\n    this.textarea = null;\r\n    this.preview = null;\r\n\r\n    let eventMouseDown = new Elementary.Collection.CollectionMap();\r\n    let eventMouseUp = new Elementary.Collection.CollectionMap();\r\n\r\n    this.button = new Elementary.Collection.CollectionMap();\r\n\r\n    this.getConfigurationDefault = function () {\r\n        const configuration = new Configuration();\r\n\r\n        // Tab configuration.\r\n        configuration.tab.add('write');\r\n        configuration.tab.add('preview');\r\n\r\n        // Button configuration.\r\n        configuration.button.add('text-headline', 'text-headline');\r\n        configuration.button.add('text-bold', 'text-bold');\r\n        configuration.button.add('text-italic', 'text-italic');\r\n        configuration.button.add('text-quote', 'text-quote');\r\n        configuration.button.add('text-code', 'text-code');\r\n        configuration.button.add('text-link', 'text-link');\r\n        configuration.button.add('text-ul', 'text-ul');\r\n        configuration.button.add('text-ol', 'text-ol');\r\n        configuration.button.add('history-forward', 'history-forward');\r\n        configuration.button.add('history-backward', 'history-backward');\r\n\r\n        // Key configuration.\r\n        configuration.key.add('ctrl+shift+z', 'history-forward');\r\n        configuration.key.add('ctrl+z', 'history-backward');\r\n\r\n        return configuration;\r\n    };\r\n\r\n    this.initialize = function (configuration) {\r\n        if (false === !!configuration) {\r\n            configuration = this.getConfigurationDefault();\r\n        }\r\n\r\n        // Set the component information.\r\n        self.setAttribute('data-component', 'markdown-notepad');\r\n        // Set the style.\r\n        self.classList.add('markdown-notepad');\r\n\r\n        this.theme = new Theme(document, configuration.getTheme());\r\n        // Only use the theme if no element is given.\r\n        if (false === !!element) {\r\n            this.theme.initialize(this);\r\n        }\r\n\r\n        self.presenter.setConfiguration(configuration);\r\n\r\n        parent.initialize();\r\n\r\n        return this;\r\n    };\r\n\r\n    this.initializeTab = function (state) {\r\n        let name = state.getName();\r\n\r\n        let tab = new Tab(document, FindOne(self, `div[data-component=\"markdown-notepad.tab.${name}\"]`), state);\r\n        tab.initialize();\r\n        // Set the style.\r\n        tab.classList.add('tab', name);\r\n\r\n        self.tab.add(name, tab);\r\n\r\n        this.initializeTabPane(state.getPane());\r\n\r\n        return this;\r\n    };\r\n\r\n    this.initializeTabPane = function (state) {\r\n        let name = state.getName();\r\n\r\n        let tabPane = new TabPane(document, FindOne(self, `div[data-component=\"markdown-notepad.tab-pane.${name}\"]`), state);\r\n        tabPane.initialize();\r\n        // Set the style.\r\n        tabPane.classList.add('tab-pane', name);\r\n\r\n        self.tabPane.add(name, tabPane);\r\n\r\n        return this;\r\n    };\r\n\r\n    this.initializeTextarea = function (state) {\r\n        let textarea = new Textarea(document, FindOne(self, 'textarea[data-component=\"markdown-notepad.textarea\"]'), state);\r\n        textarea.initialize();\r\n        // Set the style.\r\n        textarea.classList.add('markdown-textarea');\r\n\r\n        textarea.addEventListener('keydown', eventKeyDown = function (event) {\r\n            // Only continue, when ctrl or alt are down.\r\n            if (event.ctrlKey || event.altKey) {\r\n                // Create an action identifier in the format 'ctrl+alt+shift+key'.\r\n                const action = [\r\n                    event.ctrlKey\r\n                        ? 'ctrl'\r\n                        : '',\r\n                    event.altKey\r\n                        ? 'alt'\r\n                        : '',\r\n                    event.shiftKey\r\n                        ? 'shift'\r\n                        : '',\r\n                    // Grab the current key in lower case.\r\n                    (event.key).toLowerCase(),\r\n                ].filter(function (value, index, array) {\r\n                    // Filter any empty value and join them with a '+' sign.\r\n                    return 0 !== value.length;\r\n                }).join('+');\r\n\r\n                try {\r\n                    // Try to trigger the action, if it exists.\r\n                    self.presenter.triggerAction(action, true);\r\n\r\n                    event.preventDefault();\r\n                } catch (error) {\r\n                    if ('ERR_ACTION' === error) {\r\n                        // No-op, since no action was found.\r\n                    } else {\r\n                        throw error;\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        // textarea.addEventListener('keyup', eventKeyUp = function (event) {\r\n        //     self.focusTextarea();\r\n        // });\r\n        textarea.addEventListener('contextmenu', eventContextMenu = function (event) {\r\n            event.preventDefault();\r\n        });\r\n\r\n        this.textarea = textarea;\r\n\r\n        return this;\r\n    };\r\n\r\n    this.initializePreview = function (state) {\r\n        const preview = new Preview(document, FindOne(self, 'div[data-component=\"markdown-notepad.preview\"]'), state);\r\n        preview.initialize();\r\n        // Set the style.\r\n        preview.classList.add('markdown-preview');\r\n\r\n        this.preview = preview;\r\n\r\n        return this;\r\n    };\r\n\r\n    this.initializeButton = function (state) {\r\n        let name = state.getName();\r\n\r\n        const button = new Button(document, FindOne(self, `button[data-component=\"markdown-notepad.button.${name}\"]`), state);\r\n        button.initialize();\r\n        // Set the style.\r\n        button.classList.add('button', name);\r\n\r\n        // Set click callback.\r\n        const onMouseDown = function (event) {\r\n            self.presenter.triggerAction(name, true);\r\n        };\r\n        eventMouseDown.add(name, onMouseDown);\r\n        button.addEventListener('mousedown', onMouseDown);\r\n\r\n        const onMouseUp = function (event) {\r\n            self.focusTextarea();\r\n        };\r\n        eventMouseUp.add(name, onMouseUp);\r\n        button.addEventListener('mouseup', onMouseUp);\r\n\r\n        self.button.add(name, button);\r\n\r\n        return this;\r\n    };\r\n\r\n    this.focusTextarea = function () {\r\n        if (null !== this.textarea) {\r\n            this.textarea.focus();\r\n        }\r\n\r\n        return this;\r\n    };\r\n\r\n    this.destroy = function () {\r\n        parent.destroy();\r\n\r\n        this.theme.destroy();\r\n        this.theme = null;\r\n\r\n        this.tab.each(function (value, key) {\r\n            value.destroy();\r\n        });\r\n        this.tab.clear();\r\n\r\n        this.tabPane.each(function (value, key) {\r\n            value.destroy();\r\n        });\r\n        this.tabPane.clear();\r\n\r\n        this.textarea.removeEventListener('keydown', eventKeyDown);\r\n        eventKeyDown = null;\r\n        this.textarea.removeEventListener('keyup', eventKeyUp);\r\n        eventKeyUp = null;\r\n        this.textarea.removeEventListener('contextmenu', eventContextMenu);\r\n        eventContextMenu = null;\r\n\r\n        this.textarea.destroy();\r\n        this.textarea = null;\r\n        this.preview.destroy();\r\n        this.preview = null;\r\n\r\n        this.button.each(function (value, key) {\r\n            value.destroy();\r\n\r\n            const onMouseDown = eventMouseDown.get(key);\r\n            value.removeEventListener('mousedown', onMouseDown);\r\n\r\n            const onMouseUp = eventMouseUp.get(key);\r\n            value.removeEventListener('mouseup', onMouseUp);\r\n        });\r\n        this.button.clear();\r\n\r\n        eventMouseDown.clear();\r\n        eventMouseUp.clear();\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function MarkdownNotepadPresenter(state) {\r\n    const self = new Elementary.Component.ComponentPresenter(state);\r\n    const parent = {\r\n        initialize: self.initialize,\r\n        destroy: self.destroy,\r\n    };\r\n\r\n    this.update = function (state, id) {\r\n    };\r\n\r\n    this.engine = null;\r\n\r\n    let timeoutReference = null;\r\n\r\n    let callback = null;\r\n    let callbackMirror = null;\r\n    let callbackHistory = null;\r\n\r\n    this.action = new Elementary.Collection.CollectionMap();\r\n\r\n    this.configuration = null;\r\n\r\n    this.getConfiguration = function () {\r\n        return this.configuration;\r\n    };\r\n    this.setConfiguration = function (configuration) {\r\n        this.configuration = configuration;\r\n        return this;\r\n    };\r\n    this.hasConfiguration = function () {\r\n        return !!this.configuration;\r\n    };\r\n\r\n    this.fresh = false;\r\n\r\n    this.initialize = function (component) {\r\n        this.engine = new EngineMd();\r\n\r\n        callback = new Elementary.Observe.Callback('TabChange', function (state, id) {\r\n            if (state.isActive()) {\r\n                self.state.tab.each(function (value, index) {\r\n                    if (state.getName() === value.getName()) {\r\n                        return;\r\n                    }\r\n\r\n                    value.setActive(false);\r\n                    value.notify();\r\n                });\r\n            }\r\n        });\r\n\r\n        callbackMirror = new Elementary.Observe.Callback('Mirror', function (state, id) {\r\n            if (self.state.hasPreview()) {\r\n                let previewValue = state.getValue();\r\n                previewValue = self.engine.process(previewValue);\r\n\r\n                let preview = self.state.getPreview();\r\n\r\n                preview.setValue(previewValue);\r\n                preview.notify();\r\n            }\r\n        });\r\n\r\n        callbackHistory = new Elementary.Observe.Callback('History', function (state, id) {\r\n            const makeHistory = function (state) {\r\n                // TODO: Timeout offset.\r\n                if (true === !!timeoutReference) {\r\n                    clearTimeout(timeoutReference);\r\n                }\r\n\r\n                timeoutReference = setTimeout(function () {\r\n                    const snapshot = new TextSnapshot(\r\n                        new TextareaTransaction()\r\n                    );\r\n                    snapshot.attach(state.getTextarea());\r\n                    snapshot.rollback();\r\n\r\n                    state.history.add(snapshot);\r\n                    state.history.moveForward();\r\n\r\n                    snapshot.detach();\r\n                }, 1000);\r\n            };\r\n\r\n            if (self.state.history.hasCurrent()) {\r\n                const current = self.state.history.getCurrent();\r\n\r\n                if (state.getValue() !== current.getValue()) {\r\n                    makeHistory(self.state);\r\n                }\r\n            } else {\r\n                makeHistory(self.state);\r\n            }\r\n        });\r\n\r\n        parent.initialize(component);\r\n\r\n        this.initializeState();\r\n\r\n        return this;\r\n    };\r\n\r\n    this.initializeState = function () {\r\n        this.fresh = self.state.isFresh();\r\n        self.state.setFresh(false);\r\n\r\n        const configuration = this.getConfiguration();\r\n        configuration.tab.each(function (value, index) {\r\n            // Convert index 0 to false to true.\r\n            const active = false === !!index;\r\n\r\n            self.initializeTab(value, active);\r\n        });\r\n        configuration.button.each(function (value, key) {\r\n            self.initializeButton(key, value);\r\n        });\r\n        configuration.key.each(function (value, key) {\r\n            self.initializeAction(key, value, true);\r\n        });\r\n\r\n        this.initializeTextarea();\r\n        this.initializePreview();\r\n    };\r\n\r\n    this.initializeTab = function (name, active) {\r\n        const tabName = `tab-${name}`;\r\n        let tab;\r\n\r\n        if (self.state.tab.has(tabName)) {\r\n            tab = self.state.tab.get(tabName);\r\n        } else {\r\n            const tabPane = (function (name, active) {\r\n                const tabPaneName = `tab-pane-${name}`;\r\n                const tabPane = new TabPaneState();\r\n                tabPane.setName(tabPaneName);\r\n                tabPane.setActive(active);\r\n                return tabPane;\r\n            }(name, active));\r\n\r\n            tab = new TabState();\r\n            tab.setName(tabName);\r\n            tab.setActive(active);\r\n            tab.setPane(tabPane);\r\n\r\n            self.state.tab.add(tabName, tab);\r\n\r\n            tab.attachCallback(callback);\r\n        }\r\n\r\n        self.component.initializeTab(tab);\r\n\r\n        return this;\r\n    };\r\n\r\n    this.initializeTextarea = function () {\r\n        let textarea;\r\n\r\n        if (self.state.hasTextarea()) {\r\n            textarea = self.state.getTextarea();\r\n        } else {\r\n            textarea = new TextareaState();\r\n            textarea.setValue('');\r\n            // This is set in the textarea presenter.\r\n            textarea.setSelection(null);\r\n\r\n            textarea.attachCallback(callbackMirror);\r\n            textarea.attachCallback(callbackHistory);\r\n\r\n            self.state.setTextarea(textarea);\r\n        }\r\n\r\n        self.component.initializeTextarea(textarea);\r\n\r\n        return this;\r\n    };\r\n\r\n    this.initializePreview = function () {\r\n        let preview;\r\n\r\n        if (self.state.hasPreview()) {\r\n            preview = self.state.getPreview();\r\n        } else {\r\n            preview = new PreviewState();\r\n            preview.setValue('');\r\n\r\n            self.state.setPreview(preview);\r\n        }\r\n\r\n        self.component.initializePreview(preview);\r\n\r\n        return this;\r\n    };\r\n\r\n    this.initializeButton = function (name, actionName) {\r\n        const buttonName = `button-${name}`;\r\n        let button;\r\n\r\n        if (self.state.button.has(buttonName)) {\r\n            button = self.state.button.get(buttonName);\r\n        } else {\r\n            button = new ButtonState();\r\n            button.setName(buttonName);\r\n\r\n            self.state.button.add(buttonName, button);\r\n        }\r\n\r\n        this.initializeAction(buttonName, actionName, true);\r\n\r\n        self.component.initializeButton(button);\r\n\r\n        return this;\r\n    };\r\n\r\n    this.initializeAction = function (name, actionName, strict) {\r\n        // Special case, where strict is not set, but it should be true.\r\n        if ('undefined' === typeof strict) {\r\n            strict = true;\r\n        }\r\n\r\n        if (Action.registry.has(actionName)) {\r\n            const action = Action.registry.get(actionName);\r\n\r\n            this.action.add(name, action);\r\n        } else {\r\n            if (strict) {\r\n                throw 'ERR_ACTION';\r\n            }\r\n        }\r\n\r\n        return this;\r\n    };\r\n\r\n    this.triggerAction = function (name, strict) {\r\n        // Special case, where strict is not set, but it should be true.\r\n        if ('undefined' === typeof strict) {\r\n            strict = true;\r\n        }\r\n\r\n        if (this.action.has(name)) {\r\n            const action = this.action.get(name);\r\n\r\n            action.handle(self.state);\r\n        } else {\r\n            if (strict) {\r\n                throw 'ERR_ACTION';\r\n            }\r\n        }\r\n\r\n        return this;\r\n    };\r\n\r\n    this.destroy = function () {\r\n        parent.destroy();\r\n\r\n        if (this.fresh) {\r\n            self.state.tab.each(function (value, index) {\r\n                value.detachCallback(callback);\r\n            });\r\n            self.state.tab.clear();\r\n        }\r\n\r\n        timeoutReference = null;\r\n\r\n        callback = null;\r\n\r\n        if (this.fresh) {\r\n            if (self.state.hasTextarea()) {\r\n                let textarea = self.state.getTextarea();\r\n                textarea.detachCallback(callbackMirror);\r\n                textarea.detachCallback(callbackHistory);\r\n\r\n                self.state.setTextarea(null);\r\n            }\r\n        }\r\n\r\n        callbackMirror = null;\r\n        callbackHistory = null;\r\n\r\n        if (this.fresh) {\r\n            if (self.state.hasPreview()) {\r\n                self.state.setPreview(null);\r\n            }\r\n        }\r\n\r\n        this.action.clear();\r\n\r\n        if (this.fresh) {\r\n            //self.state.button.each(function (value, index) {\r\n            //});\r\n            self.state.button.clear();\r\n        }\r\n\r\n        this.engine = null;\r\n\r\n        this.configuration = null;\r\n\r\n        this.fresh = false;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function MarkdownNotepadState() {\r\n    const self = new Elementary.Component.ComponentState();\r\n\r\n    this.fresh = true;\r\n\r\n    this.isFresh = function () {\r\n        return this.fresh;\r\n    };\r\n    this.setFresh = function (fresh) {\r\n        this.fresh = fresh;\r\n        return this;\r\n    };\r\n\r\n    this.tab = new Elementary.Collection.CollectionMap();\r\n\r\n    this.textarea = null;\r\n\r\n    this.getTextarea = function () {\r\n        return this.textarea;\r\n    };\r\n    this.setTextarea = function (textarea) {\r\n        this.textarea = textarea;\r\n        return this;\r\n    };\r\n    this.hasTextarea = function () {\r\n        return !!this.textarea;\r\n    };\r\n\r\n    this.preview = null;\r\n\r\n    this.getPreview = function () {\r\n        return this.preview;\r\n    };\r\n    this.setPreview = function (preview) {\r\n        this.preview = preview;\r\n        return this;\r\n    };\r\n    this.hasPreview = function () {\r\n        return !!this.preview;\r\n    };\r\n\r\n    this.button = new Elementary.Collection.CollectionMap();\r\n\r\n    this.history = new History();\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nexport * as Base from './MarkdownNotepad/Base';\r\nexport * as Component from './MarkdownNotepad/Component';\r\nexport * as Control from './MarkdownNotepad/Control'\r\nexport * as Service from './MarkdownNotepad/Service'\r\nexport * as State from './MarkdownNotepad/State'\r\nexport * as Theme from './MarkdownNotepad/Theme'\r\nexport * as Configuration from './MarkdownNotepad/Configuration'\r\n\r\nimport {version} from '../package.json'\r\n\r\nexport const metadata = {\r\n    version: version,\r\n};\r\n"],"names":["FindOne","node","selector","element","querySelector","FindAll","elementList","querySelectorAll","length","SelectionState","self","Elementary.Component","ComponentState","this","start","getStart","setStart","end","getEnd","setEnd","direction","getDirection","setDirection","Elementary.Base","Merge","Textarea","document","state","presenter","TextareaPresenter","Component","TextareaState","parent","initialize","destroy","eventChange","eventKeyUp","eventSelectionChange","changeSelection","selectionStart","selectionEnd","selectionDirection","addEventListener","event","changeValue","value","activeElement","setValue","setSelection","removeEventListener","ComponentPresenter","update","id","component","getValue","hasSelection","selection","getSelection","initializeState","notify","Tab","TabPresenter","TabState","eventClick","changeActive","setActive","active","classList","toggle","isActive","hasPane","paneState","getPane","name","getName","setName","pane","setPane","Theme","template","control","initializeTemplate","innerHTML","add","templateElement","TabPane","TabPanePresenter","TabPaneState","Button","ButtonPresenter","ButtonState","eventMouseDown","eventMouseUp","changeClick","click","Preview","PreviewPresenter","PreviewState","Engine","process","EngineMd","md","MarkdownNotepadPack.Instance","render","Transaction","commit","snapshot","rollback","TextareaTransaction","commitSelection","rollbackSelection","before","substring","undefined","inside","after","Snapshot","attach","detach","TextSnapshot","transaction","Action","handle","registry","Elementary.Collection","CollectionMap","ActionTab","tab","has","get","ActionTabWrite","ActionTabPreview","ActionHistory","change","history","hasCurrent","hasTextarea","current","getCurrent","getTextarea","ActionHistoryForward","moveForward","ActionHistoryBackward","moveBackward","ActionText","text","check","insert","delete","ActionTextWrap","prefix","suffix","endsWith","startsWith","ActionTextPrefix","ActionTextPrefixLine","line","ActionTextHeadline","ActionTextBold","ActionTextItalic","ActionTextQuote","ActionTextCode","ActionTextLink","ActionTextUl","ActionTextOl","History","Collection","index","getIndex","setIndex","size","modifyIndex","by","pop","Configuration","theme","getTheme","setTheme","button","key","MarkdownNotepad","MarkdownNotepadPresenter","MarkdownNotepadState","tabPane","eventKeyDown","eventContextMenu","textarea","preview","getConfigurationDefault","configuration","setAttribute","setConfiguration","initializeTab","initializeTabPane","initializeTextarea","ctrlKey","altKey","action","shiftKey","toLowerCase","filter","array","join","triggerAction","preventDefault","error","initializePreview","initializeButton","onMouseDown","onMouseUp","focusTextarea","focus","each","clear","engine","timeoutReference","callback","callbackMirror","callbackHistory","getConfiguration","hasConfiguration","fresh","Elementary.Observe","Callback","hasPreview","previewValue","getPreview","makeHistory","clearTimeout","setTimeout","isFresh","setFresh","initializeAction","tabName","tabPaneName","attachCallback","setTextarea","setPreview","actionName","buttonName","strict","detachCallback","metadata","version"],"mappings":"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"}