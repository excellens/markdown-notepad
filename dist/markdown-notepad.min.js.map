{"version":3,"file":"markdown-notepad.min.js","sources":["../src/MarkdownNotepad/Base.js","../src/MarkdownNotepad/State.js","../src/MarkdownNotepad/Component/Textarea.js","../src/MarkdownNotepad/Component/Tab.js","../src/MarkdownNotepad/Theme.js","../src/MarkdownNotepad/Component/TabPane.js","../src/MarkdownNotepad/Component/Button.js","../src/MarkdownNotepad/Component/Preview.js","../src/MarkdownNotepad/Service/Engine.js","../src/MarkdownNotepad/Service/Action/Snapshot/Transaction.js","../src/MarkdownNotepad/Service/Action/Snapshot.js","../src/MarkdownNotepad/Service/Action.js","../src/MarkdownNotepad/Service/Collection.js","../src/MarkdownNotepad/Configuration.js","../src/MarkdownNotepad/Control/MarkdownNotepad.js","../src/Main.js"],"sourcesContent":["/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\n/**\r\n * @param {ParentNode} node\r\n * @param {string} selector\r\n */\r\nexport function FindOne(node, selector) {\r\n    let element = node.querySelector(selector);\r\n\r\n    if (null === element) {\r\n        throw 'ERR_FIND_ONE';\r\n    }\r\n\r\n    return element;\r\n}\r\n\r\n/**\r\n * @param {ParentNode} node\r\n * @param {string} selector\r\n */\r\nexport function FindAll(node, selector) {\r\n    let elementList = node.querySelectorAll(selector);\r\n\r\n    if (false === !!elementList.length) {\r\n        throw 'ERR_FIND_ALL';\r\n    }\r\n\r\n    return elementList;\r\n}\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as Elementary from '@excellens/elementary'\r\n\r\nexport function SelectionState() {\r\n    const self = new Elementary.Component.ComponentState();\r\n\r\n    this.start = 0;\r\n\r\n    this.getStart = function () {\r\n        return this.start;\r\n    };\r\n    this.setStart = function (start) {\r\n        this.start = start;\r\n\r\n        return this;\r\n    };\r\n\r\n    this.end = 0;\r\n\r\n    this.getEnd = function () {\r\n        return this.end;\r\n    };\r\n    this.setEnd = function (end) {\r\n        this.end = end;\r\n\r\n        return this;\r\n    };\r\n\r\n    this.direction = 'none';\r\n\r\n    this.getDirection = function () {\r\n        return this.direction;\r\n    };\r\n    this.setDirection = function (direction) {\r\n        this.direction = direction;\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as Elementary from '@excellens/elementary'\r\nimport {SelectionState} from \"../State\";\r\n\r\nexport function Textarea(document, element, state) {\r\n    const self = (function (document, element, state) {\r\n        const presenter = new TextareaPresenter(state);\r\n        return new Elementary.Component.Component(presenter, document, 'textarea', element);\r\n    }(document, element, state || new TextareaState()));\r\n    const parent = {\r\n        initialize: self.initialize,\r\n        destroy: self.destroy,\r\n    };\r\n\r\n    let eventChange = null;\r\n    let eventKeyUp = null;\r\n\r\n    let eventSelectionChange = null;\r\n\r\n    const changeSelection = function () {\r\n        const start = self.selectionStart;\r\n        const end = self.selectionEnd;\r\n\r\n        const direction = self.selectionDirection;\r\n\r\n        self.presenter.changeSelection(start, end, direction);\r\n    };\r\n\r\n    this.initialize = function () {\r\n        parent.initialize();\r\n\r\n        self.addEventListener('change', eventChange = function (event) {\r\n            changeSelection();\r\n\r\n            self.presenter.changeValue(self.value);\r\n        });\r\n        self.addEventListener('keyup', eventKeyUp = function (event) {\r\n            changeSelection();\r\n\r\n            self.presenter.changeValue(self.value);\r\n        });\r\n\r\n        document.addEventListener('selectionchange', eventSelectionChange = function (event) {\r\n            if (document.activeElement === self) {\r\n                changeSelection();\r\n            }\r\n        });\r\n\r\n        return this;\r\n    };\r\n\r\n    this.setValue = function (value) {\r\n        self.value = value;\r\n\r\n        return this;\r\n    };\r\n\r\n    this.setSelection = function (start, end, direction) {\r\n        self.selectionStart = start;\r\n        self.selectionEnd = end;\r\n\r\n        self.selectionDirection = direction;\r\n\r\n        return this;\r\n    };\r\n\r\n    this.destroy = function () {\r\n        parent.destroy();\r\n\r\n        self.removeEventListener('change', eventChange);\r\n        eventChange = null;\r\n        self.removeEventListener('keyup', eventKeyUp);\r\n        eventKeyUp = null;\r\n\r\n        document.removeEventListener('selectionchange', eventSelectionChange);\r\n        eventSelectionChange = null;\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function TextareaPresenter(state) {\r\n    const self = new Elementary.Component.ComponentPresenter(state);\r\n    const parent = {\r\n        initialize: self.initialize,\r\n        destroy: self.destroy,\r\n    };\r\n\r\n    this.update = function (state, id) {\r\n        self.component.setValue(state.getValue());\r\n\r\n        if (state.hasSelection()) {\r\n            const selection = state.getSelection();\r\n\r\n            const start = selection.getStart();\r\n            const end = selection.getEnd();\r\n\r\n            const direction = selection.getDirection();\r\n\r\n            self.component.setSelection(start, end, direction);\r\n        }\r\n    };\r\n\r\n    this.initialize = function (component) {\r\n        this.initializeState();\r\n\r\n        parent.initialize(component);\r\n\r\n        return this;\r\n    };\r\n\r\n    this.initializeState = function () {\r\n        if (!self.state.hasSelection()) {\r\n            const selection = new SelectionState();\r\n\r\n            self.state.setSelection(selection);\r\n        }\r\n\r\n        return this;\r\n    };\r\n\r\n    this.changeValue = function (value) {\r\n        if (self.state.getValue() !== value) {\r\n            self.state.setValue(value);\r\n            self.state.notify();\r\n        }\r\n\r\n        return this;\r\n    };\r\n\r\n    this.changeSelection = function (start, end, direction) {\r\n        if (self.state.hasSelection()) {\r\n            const selection = self.state.getSelection();\r\n\r\n            selection.setStart(start);\r\n            selection.setEnd(end);\r\n\r\n            selection.setDirection(direction);\r\n            selection.notify();\r\n        }\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function TextareaState() {\r\n    const self = new Elementary.Component.ComponentState();\r\n\r\n    this.value = '';\r\n\r\n    this.getValue = function () {\r\n        return this.value;\r\n    };\r\n    this.setValue = function (value) {\r\n        this.value = value;\r\n\r\n        return this;\r\n    };\r\n\r\n    this.selection = null;\r\n\r\n    this.getSelection = function () {\r\n        return this.selection;\r\n    };\r\n    this.setSelection = function (selection) {\r\n        this.selection = selection;\r\n\r\n        return this;\r\n    };\r\n    this.hasSelection = function () {\r\n        return !!this.selection;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as Elementary from '@excellens/elementary'\r\n\r\nexport function Tab(document, element, state) {\r\n    const self = (function (document, element, state) {\r\n        const presenter = new TabPresenter(state);\r\n        return new Elementary.Component.Component(presenter, document, 'div', element);\r\n    }(document, element, state || new TabState()));\r\n    const parent = {\r\n        initialize: self.initialize,\r\n        destroy: self.destroy,\r\n    };\r\n\r\n    let eventClick = null;\r\n\r\n    this.initialize = function () {\r\n        parent.initialize();\r\n\r\n        self.addEventListener('click', eventClick = function (event) {\r\n            self.presenter.changeActive(true);\r\n        });\r\n\r\n        return this;\r\n    };\r\n\r\n    this.setActive = function (active) {\r\n        self.classList.toggle('active', active);\r\n\r\n        return this;\r\n    };\r\n\r\n    this.destroy = function () {\r\n        parent.destroy();\r\n\r\n        self.removeEventListener('click', eventClick);\r\n        eventClick = null;\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function TabPresenter(state) {\r\n    const self = new Elementary.Component.ComponentPresenter(state);\r\n    const parent = {\r\n        initialize: self.initialize,\r\n        destroy: self.destroy,\r\n    };\r\n\r\n    this.update = function (state, id) {\r\n        self.component.setActive(state.isActive());\r\n\r\n        if (state.hasPane()) {\r\n            let paneState = state.getPane();\r\n            paneState.setActive(state.isActive());\r\n            paneState.notify();\r\n        }\r\n    };\r\n\r\n    this.changeActive = function (active) {\r\n        self.state.setActive(active);\r\n        self.state.notify();\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function TabState() {\r\n    const self = new Elementary.Component.ComponentState();\r\n\r\n    this.name = 'tab';\r\n\r\n    this.getName = function () {\r\n        return this.name;\r\n    };\r\n    this.setName = function (name) {\r\n        this.name = name;\r\n        return this;\r\n    };\r\n\r\n    this.active = false;\r\n\r\n    this.isActive = function () {\r\n        return this.active;\r\n    };\r\n    this.setActive = function (active) {\r\n        this.active = active;\r\n        return this;\r\n    };\r\n\r\n    this.pane = null;\r\n\r\n    this.getPane = function () {\r\n        return this.pane;\r\n    };\r\n    this.setPane = function (pane) {\r\n        this.pane = pane;\r\n        return this;\r\n    };\r\n    this.hasPane = function () {\r\n        return !!this.pane;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as Elementary from '@excellens/elementary'\r\nimport {FindOne} from \"./Base\";\r\n\r\nexport function Theme(document, id) {\r\n    const self = {};\r\n\r\n    this.id = id;\r\n\r\n    this.template = null;\r\n\r\n    this.initialize = function (control) {\r\n        this.initializeTemplate();\r\n\r\n        control.innerHTML = this.template;\r\n\r\n        const id = this.id;\r\n        control.classList.add(`theme-${id}`);\r\n\r\n        return this;\r\n    };\r\n\r\n    this.initializeTemplate = function () {\r\n        const id = this.id;\r\n\r\n        const templateElement = FindOne(document, `script[type=\"theme/markdown-notepad\"]#${id}`);\r\n        this.template = templateElement.innerHTML;\r\n\r\n        return this;\r\n    };\r\n\r\n    this.destroy = function () {\r\n        this.template = null;\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as Elementary from '@excellens/elementary'\r\n\r\nexport function TabPane(document, element, state) {\r\n    const self = (function (document, element, state) {\r\n        const presenter = new TabPanePresenter(state);\r\n        return new Elementary.Component.Component(presenter, document, 'div', element);\r\n    }(document, element, state || new TabPaneState()));\r\n    const parent = {\r\n        initialize: self.initialize,\r\n        destroy: self.destroy,\r\n    };\r\n\r\n    this.setActive = function (active) {\r\n        self.classList.toggle('active', active);\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function TabPanePresenter(state) {\r\n    const self = new Elementary.Component.ComponentPresenter(state);\r\n    const parent = {\r\n        initialize: self.initialize,\r\n        destroy: self.destroy,\r\n    };\r\n\r\n    this.update = function (state, id) {\r\n        self.component.setActive(state.isActive());\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function TabPaneState() {\r\n    const self = new Elementary.Component.ComponentState();\r\n\r\n    this.name = 'tab-pane';\r\n\r\n    this.getName = function () {\r\n        return this.name;\r\n    };\r\n    this.setName = function (name) {\r\n        this.name = name;\r\n        return this;\r\n    };\r\n\r\n    this.active = false;\r\n\r\n    this.isActive = function () {\r\n        return this.active;\r\n    };\r\n    this.setActive = function (active) {\r\n        this.active = active;\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as Elementary from '@excellens/elementary'\r\n\r\nexport function Button(document, element, state) {\r\n    const self = (function (document, element, state) {\r\n        const presenter = new ButtonPresenter(state);\r\n        return new Elementary.Component.Component(presenter, document, 'button', element);\r\n    }(document, element, state || new ButtonState()));\r\n    const parent = {\r\n        initialize: self.initialize,\r\n        destroy: self.destroy,\r\n    };\r\n\r\n    let eventMouseDown = null;\r\n    let eventMouseUp = null;\r\n\r\n    this.initialize = function () {\r\n        parent.initialize();\r\n\r\n        self.addEventListener('mousedown', eventMouseDown = function (event) {\r\n            self.presenter.changeClick(true);\r\n        });\r\n        self.addEventListener('mouseup', eventMouseUp = function (event) {\r\n            self.presenter.changeClick(false);\r\n        });\r\n\r\n        return this;\r\n    };\r\n\r\n    this.setActive = function (active) {\r\n        self.classList.toggle('active', active);\r\n\r\n        return this;\r\n    };\r\n\r\n    this.destroy = function () {\r\n        parent.destroy();\r\n\r\n        self.removeEventListener('mousedown', eventMouseDown);\r\n        eventMouseDown = null;\r\n        self.removeEventListener('mouseup', eventMouseUp);\r\n        eventMouseUp = null;\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function ButtonPresenter(state) {\r\n    const self = new Elementary.Component.ComponentPresenter(state);\r\n    const parent = {\r\n        initialize: self.initialize,\r\n        destroy: self.destroy,\r\n    };\r\n\r\n    this.update = function (state, id) {\r\n        self.component.setActive(state.isActive());\r\n    };\r\n\r\n    this.changeClick = function (click) {\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function ButtonState() {\r\n    const self = new Elementary.Component.ComponentState();\r\n\r\n    this.name = 'button';\r\n\r\n    this.getName = function () {\r\n        return this.name;\r\n    };\r\n    this.setName = function (name) {\r\n        this.name = name;\r\n        return this;\r\n    };\r\n\r\n    this.active = false;\r\n\r\n    this.isActive = function () {\r\n        return this.active;\r\n    };\r\n    this.setActive = function (active) {\r\n        this.active = active;\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as Elementary from '@excellens/elementary'\r\n\r\nexport function Preview(document, element, state) {\r\n    const self = (function (document, element, state) {\r\n        const presenter = new PreviewPresenter(state);\r\n        return new Elementary.Component.Component(presenter, document, 'div', element);\r\n    }(document, element, state || new PreviewState()));\r\n    const parent = {\r\n        initialize: self.initialize,\r\n        destroy: self.destroy,\r\n    };\r\n\r\n    this.setValue = function (value) {\r\n        self.innerHTML = value;\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function PreviewPresenter(state) {\r\n    const self = new Elementary.Component.ComponentPresenter(state);\r\n    const parent = {\r\n        initialize: self.initialize,\r\n        destroy: self.destroy,\r\n    };\r\n\r\n    this.update = function (state, id) {\r\n        self.component.setValue(state.getValue());\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function PreviewState() {\r\n    const self = new Elementary.Component.ComponentState();\r\n\r\n    this.value = '';\r\n\r\n    this.getValue = function () {\r\n        return this.value;\r\n    };\r\n    this.setValue = function (value) {\r\n        this.value = value;\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as Elementary from '@excellens/elementary'\r\nimport * as MarkdownNotepadPack from '@excellens/markdown-notepad-pack'\r\n\r\nexport function Engine() {\r\n    const self = {};\r\n\r\n    this.process = function (value) {\r\n        throw 'ERR_ENGINE_PROCESS';\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function EngineMd() {\r\n    const self = new Engine();\r\n\r\n    this.md = new MarkdownNotepadPack.Instance();\r\n\r\n    this.process = function (value) {\r\n        return this.md.render(value);\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as Elementary from '@excellens/elementary'\r\n\r\nexport function Transaction() {\r\n    const self = {};\r\n\r\n    this.commit = function (snapshot, state) {\r\n        throw 'ERR_TRANSACTION_COMMIT';\r\n    };\r\n\r\n    this.rollback = function (snapshot, state) {\r\n        throw 'ERR_TRANSACTION_ROLLBACK';\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function TextareaTransaction() {\r\n    const self = new Transaction();\r\n\r\n    this.commit = function (snapshot, state) {\r\n        state.setValue(snapshot.getValue());\r\n\r\n        if (state.hasSelection()) {\r\n            this.commitSelection(snapshot, state.getSelection());\r\n        }\r\n\r\n        state.notify();\r\n\r\n        return this;\r\n    };\r\n\r\n    this.commitSelection = function (snapshot, state) {\r\n        state.setStart(\r\n            snapshot.start\r\n        );\r\n        state.setEnd(\r\n            snapshot.end\r\n        );\r\n\r\n        state.notify();\r\n\r\n        return this;\r\n    };\r\n\r\n    this.rollback = function (snapshot, state) {\r\n        const value = state.getValue();\r\n\r\n        if (state.hasSelection()) {\r\n            this.rollbackSelection(snapshot, state.getSelection());\r\n        } else {\r\n            snapshot.start /**/ = value.length;\r\n            snapshot.end /****/ = value.length;\r\n        }\r\n\r\n        snapshot.before /*****/ = value.substring(\r\n            undefined,\r\n            snapshot.start\r\n        );\r\n        snapshot.inside /*****/ = value.substring(\r\n            snapshot.start,\r\n            snapshot.end\r\n        );\r\n        snapshot.after /******/ = value.substring(\r\n            snapshot.end,\r\n            undefined\r\n        );\r\n\r\n        return this;\r\n    };\r\n\r\n    this.rollbackSelection = function (snapshot, state) {\r\n        snapshot.start /**/ = state.getStart();\r\n        snapshot.end /****/ = state.getEnd();\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as Elementary from '@excellens/elementary'\r\n\r\nexport function Snapshot() {\r\n    const self = {};\r\n\r\n    this.state = null;\r\n\r\n    this.initialize = function () {\r\n        if (false === !!this.state) {\r\n            throw 'ERR_SNAPSHOT_INITIALIZE';\r\n        }\r\n\r\n        this.rollback();\r\n\r\n        return this;\r\n    };\r\n\r\n    this.attach = function (state) {\r\n        this.state = state;\r\n\r\n        return this;\r\n    };\r\n    this.detach = function () {\r\n        this.state = null;\r\n\r\n        return this;\r\n    };\r\n\r\n    this.rollback = function () {\r\n        throw 'ERR_SNAPSHOT_ROLLBACK';\r\n    };\r\n\r\n    this.commit = function () {\r\n        throw 'ERR_SNAPSHOT_COMMIT';\r\n    };\r\n\r\n    this.destroy = function () {\r\n        if (true === !!this.state) {\r\n            throw 'ERR_SNAPSHOT_DESTROY';\r\n        }\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function TextSnapshot(transaction) {\r\n    const self = new Snapshot();\r\n    const parent = {\r\n        initialize: self.initialize,\r\n        destroy: self.destroy,\r\n    };\r\n\r\n    // Handle state only in transaction.\r\n    this.transaction = transaction;\r\n\r\n    this.start /******/ = 0;\r\n    this.end /********/ = 0;\r\n\r\n    this.before /*****/ = null;\r\n    this.inside /*****/ = null;\r\n    this.after /******/ = null;\r\n\r\n    this.getValue = function () {\r\n        return this.before + this.inside + this.after;\r\n    };\r\n\r\n    this.initialize = function (state) {\r\n        self.attach(state);\r\n\r\n        return parent.initialize();\r\n    };\r\n\r\n    this.commit = function () {\r\n        this.transaction.commit(this, self.state);\r\n\r\n        return this;\r\n    };\r\n\r\n    this.rollback = function () {\r\n        this.transaction.rollback(this, self.state);\r\n\r\n        return this;\r\n    };\r\n\r\n    this.destroy = function () {\r\n        self.detach();\r\n\r\n        this.start /******/ = 0;\r\n        this.end /********/ = 0;\r\n\r\n        this.before /*****/ = null;\r\n        this.inside /*****/ = null;\r\n        this.after /******/ = null;\r\n\r\n        return parent.destroy();\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport * as Transaction from './Snapshot/Transaction'\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as Elementary from '@excellens/elementary'\r\nimport {TextSnapshot} from \"./Action/Snapshot\";\r\nimport {TextareaTransaction} from \"./Action/Snapshot/Transaction\";\r\n\r\nexport function Action(handle) {\r\n    const self = {};\r\n\r\n    if (true === !!handle) {\r\n        this.handle = handle;\r\n    } else {\r\n        this.handle = function (state) {\r\n            throw 'ERR_ACTION_HANDLE';\r\n        };\r\n    }\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nAction.registry = new Elementary.Collection.CollectionMap();\r\n\r\nexport function ActionTab(name) {\r\n    const self = new Action(null);\r\n\r\n    this.name = name;\r\n\r\n    this.handle = function (state) {\r\n        if (state.tab.has(this.name)) {\r\n            const tab = state.tab.get(this.name);\r\n            tab.setActive(true);\r\n            tab.notify();\r\n        }\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function ActionTabWrite() {\r\n    const self = new ActionTab('write');\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nAction.registry.add('tab-write', new ActionTabWrite());\r\n\r\nexport function ActionTabPreview() {\r\n    const self = new ActionTab('preview');\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nAction.registry.add('tab-preview', new ActionTabPreview());\r\n\r\nexport function ActionHistory() {\r\n    const self = new Action(null);\r\n\r\n    this.handle = function (state) {\r\n        this.change(state.history);\r\n        return this.update(state.history, state);\r\n    };\r\n\r\n    this.change = function (history) {\r\n        throw 'ERR_ACTION_HISTORY_CHANGE';\r\n    };\r\n\r\n    this.update = function (history, state) {\r\n        if (history.hasCurrent() && state.hasTextarea()) {\r\n            const current = history.getCurrent();\r\n\r\n            // The transaction has to support the textarea state.\r\n            current.attach(state.getTextarea());\r\n            current.commit();\r\n            current.detach();\r\n        }\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function ActionHistoryForward() {\r\n    const self = new ActionHistory();\r\n\r\n    this.change = function (history) {\r\n        history.moveForward();\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nAction.registry.add('history-forward', new ActionHistoryForward());\r\n\r\nexport function ActionHistoryBackward() {\r\n    const self = new ActionHistory();\r\n\r\n    this.change = function (history) {\r\n        history.moveBackward();\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nAction.registry.add('history-backward', new ActionHistoryBackward());\r\n\r\nexport function ActionText() {\r\n    const self = new Action(null);\r\n\r\n    const text = new TextSnapshot(\r\n        new TextareaTransaction()\r\n    );\r\n\r\n    this.handle = function (state) {\r\n        if (state.hasTextarea()) {\r\n            text.initialize(state.getTextarea());\r\n\r\n            if (!this.check(state, text)) {\r\n                this.insert(state, text);\r\n            } else {\r\n                this.delete(state, text);\r\n            }\r\n            text.commit();\r\n\r\n            text.destroy();\r\n        }\r\n\r\n        return this;\r\n    };\r\n\r\n    this.check = function (state, text) {\r\n        throw 'ERR_ACTION_TEXT_CHECK';\r\n    };\r\n\r\n    this.insert = function (state, text) {\r\n        throw 'ERR_ACTION_TEXT_INSERT';\r\n    };\r\n    this.delete = function (state, text) {\r\n        throw 'ERR_ACTION_TEXT_DELETE';\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function ActionTextWrap(prefix, suffix) {\r\n    const self = new ActionText();\r\n    const parent = {\r\n        insert: self.insert,\r\n        delete: self.delete,\r\n    };\r\n\r\n    this.prefix = prefix;\r\n    this.suffix = suffix;\r\n\r\n    this.check = function (state, text) {\r\n        return text.before.endsWith(self.prefix)\r\n            && text.after.startsWith(self.suffix);\r\n    };\r\n\r\n    this.insert = function (state, text) {\r\n        text.before = text.before + this.prefix;\r\n        text.after = this.suffix + text.after;\r\n\r\n        text.start = text.start + this.prefix.length;\r\n        text.end = text.end + this.prefix.length;\r\n\r\n        return this;\r\n    };\r\n\r\n    this.delete = function (state, text) {\r\n        text.before = text.before.substring(undefined, text.before.length - this.prefix.length);\r\n        text.after = text.after.substring(undefined, text.after.length - this.suffix.length);\r\n\r\n        text.start = text.start - this.prefix.length;\r\n        text.end = text.end - this.prefix.length;\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function ActionTextPrefix(prefix) {\r\n    const self = new ActionTextWrap(prefix, '');\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function ActionTextPrefixLine(prefix) {\r\n    const self = new ActionTextPrefix(prefix);\r\n    const parent = {\r\n        insert: self.insert,\r\n        delete: self.delete,\r\n    };\r\n\r\n    this.insert = function (state, text) {\r\n        const line = '\\n';\r\n\r\n        if (0 < text.before.length && !text.before.endsWith(line)) {\r\n            text.before = text.before + line;\r\n\r\n            text.start = text.start + line.length;\r\n            text.end = text.end + line.length;\r\n        }\r\n\r\n        return parent.insert(state, text);\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function ActionTextHeadline() {\r\n    const self = new ActionTextPrefix('### ');\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nAction.registry.add('text-headline', new ActionTextHeadline());\r\n\r\nexport function ActionTextBold() {\r\n    const self = new ActionTextWrap('**', '**');\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nAction.registry.add('text-bold', new ActionTextBold());\r\n\r\nexport function ActionTextItalic() {\r\n    const self = new ActionTextWrap('_', '_');\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nAction.registry.add('text-italic', new ActionTextItalic());\r\n\r\nexport function ActionTextQuote() {\r\n    const self = new ActionTextPrefixLine('> ');\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nAction.registry.add('text-quote', new ActionTextQuote());\r\n\r\nexport function ActionTextCode() {\r\n    const self = new ActionTextWrap('`', '`');\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nAction.registry.add('text-code', new ActionTextCode());\r\n\r\nexport function ActionTextLink() {\r\n    const self = new ActionTextWrap('[', ']');\r\n    const parent = {\r\n        insert: self.insert,\r\n        delete: self.delete,\r\n    };\r\n\r\n    this.check = function (state, text) {\r\n        return false;\r\n    };\r\n\r\n    this.insert = function (state, text) {\r\n        const line = '(url)';\r\n\r\n        text.after = line + text.after;\r\n\r\n        if (0 < text.inside.length) {\r\n            text.start = text.end + self.suffix.length + '('.length;\r\n            text.end = text.end + self.suffix.length + '('.length + 'url'.length;\r\n        }\r\n\r\n        return parent.insert(state, text);\r\n    };\r\n\r\n    this.delete = function (state, text) {\r\n        return parent.delete(state, text);\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\nAction.registry.add('text-link', new ActionTextLink());\r\n\r\nexport function ActionTextUl() {\r\n    const self = new ActionTextPrefixLine('- ');\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nAction.registry.add('text-ul', new ActionTextUl());\r\n\r\nexport function ActionTextOl() {\r\n    const self = new ActionTextPrefixLine('1. ');\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nAction.registry.add('text-ol', new ActionTextOl());\r\n\r\nexport * as Snapshot from './Action/Snapshot'\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as Elementary from '@excellens/elementary'\r\n\r\nexport function History() {\r\n    const self = new Elementary.Collection.Collection();\r\n    const parent = {\r\n        add: self.add,\r\n    };\r\n\r\n    this.index = 0;\r\n\r\n    this.getIndex = function () {\r\n        return this.index;\r\n    };\r\n    this.setIndex = function (index) {\r\n        if (0 > index) {\r\n            index = 0;\r\n        }\r\n\r\n        const size = self.size();\r\n        if (index >= size) {\r\n            index = size - 1;\r\n        }\r\n\r\n        this.index = index;\r\n\r\n        return this;\r\n    };\r\n\r\n    this.modifyIndex = function (by) {\r\n        this.setIndex(\r\n            this.getIndex() + by\r\n        );\r\n\r\n        return this;\r\n    };\r\n\r\n    this.moveForward = function () {\r\n        return this.modifyIndex(+1);\r\n    };\r\n    this.moveBackward = function () {\r\n        return this.modifyIndex(-1);\r\n    };\r\n\r\n    this.getCurrent = function () {\r\n        return self.get(\r\n            this.getIndex()\r\n        );\r\n    };\r\n    this.hasCurrent = function () {\r\n        return self.has(\r\n            this.getIndex()\r\n        );\r\n    };\r\n\r\n    this.add = function (index, value) {\r\n        // Remove the loose end of the list if we are behind.\r\n        while (this.getIndex() < self.size() - 1) {\r\n            self.pop();\r\n        }\r\n\r\n        return parent.add(index, value);\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as Elementary from '@excellens/elementary'\r\n\r\nexport function Configuration() {\r\n    const self = {};\r\n\r\n    this.theme = 'default';\r\n\r\n    this.getTheme = function () {\r\n        return this.theme;\r\n    };\r\n    this.setTheme = function (theme) {\r\n        this.theme = theme;\r\n        return this;\r\n    };\r\n\r\n    this.tab = new Elementary.Collection.Collection();\r\n\r\n    this.button = new Elementary.Collection.CollectionMap();\r\n\r\n    this.key = new Elementary.Collection.CollectionMap();\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport * as Elementary from '@excellens/elementary'\r\nimport {Theme} from \"../Theme\";\r\nimport {FindOne} from \"../Base\";\r\nimport {Tab, TabState} from \"../Component/Tab\";\r\nimport {TabPane, TabPaneState} from \"../Component/TabPane\";\r\nimport {Button, ButtonState} from \"../Component/Button\";\r\nimport {Textarea, TextareaState} from \"../Component/Textarea\";\r\nimport {Preview, PreviewState} from \"../Component/Preview\";\r\nimport {EngineMd} from \"../Service/Engine\";\r\nimport {TextSnapshot} from \"../Service/Action/Snapshot\";\r\nimport {Action} from \"../Service/Action\";\r\nimport {History} from \"../Service/Collection\";\r\nimport {TextareaTransaction} from \"../Service/Action/Snapshot/Transaction\";\r\nimport {Configuration} from \"../Configuration\";\r\n\r\nexport function MarkdownNotepad(document, element, state) {\r\n    const self = (function (document, element, state) {\r\n        const presenter = new MarkdownNotepadPresenter(state);\r\n        return new Elementary.Component.Component(presenter, document, 'div', element);\r\n    }(document, element, state || new MarkdownNotepadState()));\r\n    const parent = {\r\n        initialize: self.initialize,\r\n        destroy: self.destroy,\r\n    };\r\n\r\n    this.theme = null;\r\n\r\n    this.tab = new Elementary.Collection.CollectionMap();\r\n    this.tabPane = new Elementary.Collection.CollectionMap();\r\n\r\n    let eventKeyDown = null;\r\n    let eventKeyUp = null;\r\n    let eventContextMenu = null;\r\n\r\n    this.textarea = null;\r\n    this.preview = null;\r\n\r\n    let eventMouseDown = new Elementary.Collection.CollectionMap();\r\n    let eventMouseUp = new Elementary.Collection.CollectionMap();\r\n\r\n    this.button = new Elementary.Collection.CollectionMap();\r\n\r\n    this.getConfigurationDefault = function () {\r\n        const configuration = new Configuration();\r\n\r\n        // Tab configuration.\r\n        configuration.tab.add('write');\r\n        configuration.tab.add('preview');\r\n\r\n        // Button configuration.\r\n        configuration.button.add('text-headline', 'text-headline');\r\n        configuration.button.add('text-bold', 'text-bold');\r\n        configuration.button.add('text-italic', 'text-italic');\r\n        configuration.button.add('text-quote', 'text-quote');\r\n        configuration.button.add('text-code', 'text-code');\r\n        configuration.button.add('text-link', 'text-link');\r\n        configuration.button.add('text-ul', 'text-ul');\r\n        configuration.button.add('text-ol', 'text-ol');\r\n        configuration.button.add('history-forward', 'history-forward');\r\n        configuration.button.add('history-backward', 'history-backward');\r\n\r\n        // Key configuration.\r\n        configuration.key.add('ctrl+shift+z', 'history-forward');\r\n        configuration.key.add('ctrl+z', 'history-backward');\r\n\r\n        return configuration;\r\n    };\r\n\r\n    this.initialize = function (configuration) {\r\n        if (false === !!configuration) {\r\n            configuration = this.getConfigurationDefault();\r\n        }\r\n\r\n        // Set the component information.\r\n        self.setAttribute('data-component', 'markdown-notepad');\r\n        // Set the style.\r\n        self.classList.add('markdown-notepad');\r\n\r\n        this.theme = new Theme(document, configuration.getTheme());\r\n        // Only use the theme if no element is given.\r\n        if (false === !!element) {\r\n            this.theme.initialize(this);\r\n        }\r\n\r\n        self.presenter.setConfiguration(configuration);\r\n\r\n        parent.initialize();\r\n\r\n        return this;\r\n    };\r\n\r\n    this.initializeTab = function (state) {\r\n        let name = state.getName();\r\n\r\n        let tab = new Tab(document, FindOne(self, `div[data-component=\"markdown-notepad.tab.${name}\"]`), state);\r\n        tab.initialize();\r\n        // Set the style.\r\n        tab.classList.add('tab', name);\r\n\r\n        self.tab.add(name, tab);\r\n\r\n        this.initializeTabPane(state.getPane());\r\n\r\n        return this;\r\n    };\r\n\r\n    this.initializeTabPane = function (state) {\r\n        let name = state.getName();\r\n\r\n        let tabPane = new TabPane(document, FindOne(self, `div[data-component=\"markdown-notepad.tab-pane.${name}\"]`), state);\r\n        tabPane.initialize();\r\n        // Set the style.\r\n        tabPane.classList.add('tab-pane', name);\r\n\r\n        self.tabPane.add(name, tabPane);\r\n\r\n        return this;\r\n    };\r\n\r\n    this.initializeTextarea = function (state) {\r\n        let textarea = new Textarea(document, FindOne(self, 'textarea[data-component=\"markdown-notepad.textarea\"]'), state);\r\n        textarea.initialize();\r\n        // Set the style.\r\n        textarea.classList.add('markdown-textarea');\r\n\r\n        textarea.addEventListener('keydown', eventKeyDown = function (event) {\r\n            // Only continue, when ctrl or alt are down.\r\n            if (event.ctrlKey || event.altKey) {\r\n                // Create an action identifier in the format 'ctrl+alt+shift+key'.\r\n                const action = [\r\n                    event.ctrlKey\r\n                        ? 'ctrl'\r\n                        : '',\r\n                    event.altKey\r\n                        ? 'alt'\r\n                        : '',\r\n                    event.shiftKey\r\n                        ? 'shift'\r\n                        : '',\r\n                    // Grab the current key in lower case.\r\n                    (event.key).toLowerCase(),\r\n                ].filter(function (value, index, array) {\r\n                    // Filter any empty value and join them with a '+' sign.\r\n                    return 0 !== value.length;\r\n                }).join('+');\r\n\r\n                try {\r\n                    // Try to trigger the action, if it exists.\r\n                    self.presenter.triggerAction(action, true);\r\n\r\n                    event.preventDefault();\r\n                } catch (error) {\r\n                    if ('ERR_ACTION' === error) {\r\n                        // No-op, since no action was found.\r\n                    } else {\r\n                        throw error;\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        // textarea.addEventListener('keyup', eventKeyUp = function (event) {\r\n        //     self.focusTextarea();\r\n        // });\r\n        textarea.addEventListener('contextmenu', eventContextMenu = function (event) {\r\n            event.preventDefault();\r\n        });\r\n\r\n        this.textarea = textarea;\r\n\r\n        return this;\r\n    };\r\n\r\n    this.initializePreview = function (state) {\r\n        const preview = new Preview(document, FindOne(self, 'div[data-component=\"markdown-notepad.preview\"]'), state);\r\n        preview.initialize();\r\n        // Set the style.\r\n        preview.classList.add('markdown-preview');\r\n\r\n        this.preview = preview;\r\n\r\n        return this;\r\n    };\r\n\r\n    this.initializeButton = function (state) {\r\n        let name = state.getName();\r\n\r\n        const button = new Button(document, FindOne(self, `button[data-component=\"markdown-notepad.button.${name}\"]`), state);\r\n        button.initialize();\r\n        // Set the style.\r\n        button.classList.add('button', name);\r\n\r\n        // Set click callback.\r\n        const onMouseDown = function (event) {\r\n            self.presenter.triggerAction(name, true);\r\n        };\r\n        eventMouseDown.add(name, onMouseDown);\r\n        button.addEventListener('mousedown', onMouseDown);\r\n\r\n        const onMouseUp = function (event) {\r\n            self.focusTextarea();\r\n        };\r\n        eventMouseUp.add(name, onMouseUp);\r\n        button.addEventListener('mouseup', onMouseUp);\r\n\r\n        self.button.add(name, button);\r\n\r\n        return this;\r\n    };\r\n\r\n    this.focusTextarea = function () {\r\n        if (null !== this.textarea) {\r\n            this.textarea.focus();\r\n        }\r\n\r\n        return this;\r\n    };\r\n\r\n    this.destroy = function () {\r\n        parent.destroy();\r\n\r\n        this.theme.destroy();\r\n        this.theme = null;\r\n\r\n        this.tab.each(function (value, key) {\r\n            value.destroy();\r\n        });\r\n        this.tab.clear();\r\n\r\n        this.tabPane.each(function (value, key) {\r\n            value.destroy();\r\n        });\r\n        this.tabPane.clear();\r\n\r\n        this.textarea.removeEventListener('keydown', eventKeyDown);\r\n        eventKeyDown = null;\r\n        this.textarea.removeEventListener('keyup', eventKeyUp);\r\n        eventKeyUp = null;\r\n        this.textarea.removeEventListener('contextmenu', eventContextMenu);\r\n        eventContextMenu = null;\r\n\r\n        this.textarea.destroy();\r\n        this.textarea = null;\r\n        this.preview.destroy();\r\n        this.preview = null;\r\n\r\n        this.button.each(function (value, key) {\r\n            value.destroy();\r\n\r\n            const onMouseDown = eventMouseDown.get(key);\r\n            value.removeEventListener('mousedown', onMouseDown);\r\n\r\n            const onMouseUp = eventMouseUp.get(key);\r\n            value.removeEventListener('mouseup', onMouseUp);\r\n        });\r\n        this.button.clear();\r\n\r\n        eventMouseDown.clear();\r\n        eventMouseUp.clear();\r\n\r\n        return this;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function MarkdownNotepadPresenter(state) {\r\n    const self = new Elementary.Component.ComponentPresenter(state);\r\n    const parent = {\r\n        initialize: self.initialize,\r\n        destroy: self.destroy,\r\n    };\r\n\r\n    this.update = function (state, id) {\r\n    };\r\n\r\n    this.engine = null;\r\n\r\n    let timeoutReference = null;\r\n\r\n    let callback = null;\r\n    let callbackMirror = null;\r\n    let callbackHistory = null;\r\n\r\n    this.action = new Elementary.Collection.CollectionMap();\r\n\r\n    this.configuration = null;\r\n\r\n    this.getConfiguration = function () {\r\n        return this.configuration;\r\n    };\r\n    this.setConfiguration = function (configuration) {\r\n        this.configuration = configuration;\r\n        return this;\r\n    };\r\n    this.hasConfiguration = function () {\r\n        return !!this.configuration;\r\n    };\r\n\r\n    this.fresh = false;\r\n\r\n    this.initialize = function (component) {\r\n        this.engine = new EngineMd();\r\n\r\n        callback = new Elementary.Observe.Callback('TabChange', function (state, id) {\r\n            if (state.isActive()) {\r\n                self.state.tab.each(function (value, index) {\r\n                    if (state.getName() === value.getName()) {\r\n                        return;\r\n                    }\r\n\r\n                    value.setActive(false);\r\n                    value.notify();\r\n                });\r\n            }\r\n        });\r\n\r\n        callbackMirror = new Elementary.Observe.Callback('Mirror', function (state, id) {\r\n            if (self.state.hasPreview()) {\r\n                let previewValue = state.getValue();\r\n                previewValue = self.engine.process(previewValue);\r\n\r\n                let preview = self.state.getPreview();\r\n\r\n                preview.setValue(previewValue);\r\n                preview.notify();\r\n            }\r\n        });\r\n\r\n        callbackHistory = new Elementary.Observe.Callback('History', function (state, id) {\r\n            const makeHistory = function (state) {\r\n                // TODO: Timeout offset.\r\n                if (true === !!timeoutReference) {\r\n                    clearTimeout(timeoutReference);\r\n                }\r\n\r\n                timeoutReference = setTimeout(function () {\r\n                    const snapshot = new TextSnapshot(\r\n                        new TextareaTransaction()\r\n                    );\r\n                    snapshot.attach(state.getTextarea());\r\n                    snapshot.rollback();\r\n\r\n                    state.history.add(snapshot);\r\n                    state.history.moveForward();\r\n\r\n                    snapshot.detach();\r\n                }, 1000);\r\n            };\r\n\r\n            if (self.state.history.hasCurrent()) {\r\n                const current = self.state.history.getCurrent();\r\n\r\n                if (state.getValue() !== current.getValue()) {\r\n                    makeHistory(self.state);\r\n                }\r\n            } else {\r\n                makeHistory(self.state);\r\n            }\r\n        });\r\n\r\n        parent.initialize(component);\r\n\r\n        this.initializeState();\r\n\r\n        return this;\r\n    };\r\n\r\n    this.initializeState = function () {\r\n        this.fresh = self.state.isFresh();\r\n        self.state.setFresh(false);\r\n\r\n        const configuration = this.getConfiguration();\r\n        configuration.tab.each(function (value, index) {\r\n            // Convert index 0 to false to true.\r\n            const active = false === !!index;\r\n\r\n            self.initializeTab(value, active);\r\n        });\r\n        configuration.button.each(function (value, key) {\r\n            self.initializeButton(key, value);\r\n        });\r\n        configuration.key.each(function (value, key) {\r\n            self.initializeAction(key, value, true);\r\n        });\r\n\r\n        this.initializeTextarea();\r\n        this.initializePreview();\r\n    };\r\n\r\n    this.initializeTab = function (name, active) {\r\n        const tabName = `tab-${name}`;\r\n        let tab;\r\n\r\n        if (self.state.tab.has(tabName)) {\r\n            tab = self.state.tab.get(tabName);\r\n        } else {\r\n            const tabPane = (function (name, active) {\r\n                const tabPaneName = `tab-pane-${name}`;\r\n                const tabPane = new TabPaneState();\r\n                tabPane.setName(tabPaneName);\r\n                tabPane.setActive(active);\r\n                return tabPane;\r\n            }(name, active));\r\n\r\n            tab = new TabState();\r\n            tab.setName(tabName);\r\n            tab.setActive(active);\r\n            tab.setPane(tabPane);\r\n\r\n            self.state.tab.add(tabName, tab);\r\n\r\n            tab.attachCallback(callback);\r\n        }\r\n\r\n        self.component.initializeTab(tab);\r\n\r\n        return this;\r\n    };\r\n\r\n    this.initializeTextarea = function () {\r\n        let textarea;\r\n\r\n        if (self.state.hasTextarea()) {\r\n            textarea = self.state.getTextarea();\r\n        } else {\r\n            textarea = new TextareaState();\r\n            textarea.setValue('');\r\n            // This is set in the textarea presenter.\r\n            textarea.setSelection(null);\r\n\r\n            textarea.attachCallback(callbackMirror);\r\n            textarea.attachCallback(callbackHistory);\r\n\r\n            self.state.setTextarea(textarea);\r\n        }\r\n\r\n        self.component.initializeTextarea(textarea);\r\n\r\n        return this;\r\n    };\r\n\r\n    this.initializePreview = function () {\r\n        let preview;\r\n\r\n        if (self.state.hasPreview()) {\r\n            preview = self.state.getPreview();\r\n        } else {\r\n            preview = new PreviewState();\r\n            preview.setValue('');\r\n\r\n            self.state.setPreview(preview);\r\n        }\r\n\r\n        self.component.initializePreview(preview);\r\n\r\n        return this;\r\n    };\r\n\r\n    this.initializeButton = function (name, actionName) {\r\n        const buttonName = `button-${name}`;\r\n        let button;\r\n\r\n        if (self.state.button.has(buttonName)) {\r\n            button = self.state.button.get(buttonName);\r\n        } else {\r\n            button = new ButtonState();\r\n            button.setName(buttonName);\r\n\r\n            self.state.button.add(buttonName, button);\r\n        }\r\n\r\n        this.initializeAction(buttonName, actionName, true);\r\n\r\n        self.component.initializeButton(button);\r\n\r\n        return this;\r\n    };\r\n\r\n    this.initializeAction = function (name, actionName, strict) {\r\n        // Special case, where strict is not set, but it should be true.\r\n        if ('undefined' === typeof strict) {\r\n            strict = true;\r\n        }\r\n\r\n        if (Action.registry.has(actionName)) {\r\n            const action = Action.registry.get(actionName);\r\n\r\n            this.action.add(name, action);\r\n        } else {\r\n            if (strict) {\r\n                throw 'ERR_ACTION';\r\n            }\r\n        }\r\n\r\n        return this;\r\n    };\r\n\r\n    this.triggerAction = function (name, strict) {\r\n        // Special case, where strict is not set, but it should be true.\r\n        if ('undefined' === typeof strict) {\r\n            strict = true;\r\n        }\r\n\r\n        if (this.action.has(name)) {\r\n            const action = this.action.get(name);\r\n\r\n            action.handle(self.state);\r\n        } else {\r\n            if (strict) {\r\n                throw 'ERR_ACTION';\r\n            }\r\n        }\r\n\r\n        return this;\r\n    };\r\n\r\n    this.destroy = function () {\r\n        parent.destroy();\r\n\r\n        if (this.fresh) {\r\n            self.state.tab.each(function (value, index) {\r\n                value.detachCallback(callback);\r\n            });\r\n            self.state.tab.clear();\r\n        }\r\n\r\n        timeoutReference = null;\r\n\r\n        callback = null;\r\n\r\n        if (this.fresh) {\r\n            if (self.state.hasTextarea()) {\r\n                let textarea = self.state.getTextarea();\r\n                textarea.detachCallback(callbackMirror);\r\n                textarea.detachCallback(callbackHistory);\r\n\r\n                self.state.setTextarea(null);\r\n            }\r\n        }\r\n\r\n        callbackMirror = null;\r\n        callbackHistory = null;\r\n\r\n        if (this.fresh) {\r\n            if (self.state.hasPreview()) {\r\n                self.state.setPreview(null);\r\n            }\r\n        }\r\n\r\n        this.action.clear();\r\n\r\n        if (this.fresh) {\r\n            //self.state.button.each(function (value, index) {\r\n            //});\r\n            self.state.button.clear();\r\n        }\r\n\r\n        this.engine = null;\r\n\r\n        this.configuration = null;\r\n\r\n        this.fresh = false;\r\n    };\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n\r\nexport function MarkdownNotepadState() {\r\n    const self = new Elementary.Component.ComponentState();\r\n\r\n    this.fresh = true;\r\n\r\n    this.isFresh = function () {\r\n        return this.fresh;\r\n    };\r\n    this.setFresh = function (fresh) {\r\n        this.fresh = fresh;\r\n        return this;\r\n    };\r\n\r\n    this.tab = new Elementary.Collection.CollectionMap();\r\n\r\n    this.textarea = null;\r\n\r\n    this.getTextarea = function () {\r\n        return this.textarea;\r\n    };\r\n    this.setTextarea = function (textarea) {\r\n        this.textarea = textarea;\r\n        return this;\r\n    };\r\n    this.hasTextarea = function () {\r\n        return !!this.textarea;\r\n    };\r\n\r\n    this.preview = null;\r\n\r\n    this.getPreview = function () {\r\n        return this.preview;\r\n    };\r\n    this.setPreview = function (preview) {\r\n        this.preview = preview;\r\n        return this;\r\n    };\r\n    this.hasPreview = function () {\r\n        return !!this.preview;\r\n    };\r\n\r\n    this.button = new Elementary.Collection.CollectionMap();\r\n\r\n    this.history = new History();\r\n\r\n    return Elementary.Base.Merge(this, self);\r\n}\r\n","/*\r\n * MIT License\r\n * Copyright (c) 2020 Excellens\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nexport * as Base from './MarkdownNotepad/Base';\r\nexport * as Component from './MarkdownNotepad/Component';\r\nexport * as Control from './MarkdownNotepad/Control'\r\nexport * as Service from './MarkdownNotepad/Service'\r\nexport * as State from './MarkdownNotepad/State'\r\nexport * as Theme from './MarkdownNotepad/Theme'\r\nexport * as Configuration from './MarkdownNotepad/Configuration'\r\n\r\nimport {version} from '../package.json'\r\n\r\nexport const metadata = {\r\n    version: version,\r\n};\r\n"],"names":["FindOne","node","selector","element","querySelector","elementList","querySelectorAll","length","SelectionState","self","Elementary.Component","ComponentState","this","start","getStart","setStart","end","getEnd","setEnd","direction","getDirection","setDirection","Elementary.Base","Merge","Textarea","document","state","presenter","TextareaPresenter","Component","TextareaState","parent","initialize","destroy","eventChange","eventKeyUp","eventSelectionChange","changeSelection","selectionStart","selectionEnd","selectionDirection","addEventListener","event","changeValue","value","activeElement","setValue","setSelection","removeEventListener","ComponentPresenter","update","id","component","getValue","hasSelection","selection","getSelection","initializeState","notify","Tab","TabPresenter","TabState","eventClick","changeActive","setActive","active","classList","toggle","isActive","hasPane","paneState","getPane","name","getName","setName","pane","setPane","Theme","template","control","initializeTemplate","innerHTML","add","templateElement","TabPane","TabPanePresenter","TabPaneState","Button","ButtonPresenter","ButtonState","eventMouseDown","eventMouseUp","changeClick","click","Preview","PreviewPresenter","PreviewState","Engine","process","EngineMd","md","MarkdownNotepadPack.Instance","render","Transaction","commit","snapshot","rollback","TextareaTransaction","commitSelection","rollbackSelection","before","substring","undefined","inside","after","Snapshot","attach","detach","TextSnapshot","transaction","Action","handle","ActionTab","tab","has","get","ActionTabWrite","ActionTabPreview","ActionHistory","change","history","hasCurrent","hasTextarea","current","getCurrent","getTextarea","ActionHistoryForward","moveForward","ActionHistoryBackward","moveBackward","ActionText","text","check","delete","insert","ActionTextWrap","prefix","suffix","endsWith","startsWith","ActionTextPrefix","ActionTextPrefixLine","line","ActionTextHeadline","ActionTextBold","ActionTextItalic","ActionTextQuote","ActionTextCode","ActionTextLink","ActionTextUl","ActionTextOl","registry","Elementary.Collection","CollectionMap","History","Collection","index","getIndex","setIndex","size","modifyIndex","by","pop","Configuration","theme","getTheme","setTheme","button","key","MarkdownNotepadPresenter","engine","timeoutReference","callback","callbackMirror","callbackHistory","action","configuration","getConfiguration","setConfiguration","hasConfiguration","fresh","Elementary.Observe","Callback","each","hasPreview","previewValue","preview","getPreview","makeHistory","clearTimeout","setTimeout","isFresh","setFresh","initializeTab","initializeButton","initializeAction","initializeTextarea","initializePreview","tabName","tabPane","tabPaneName","attachCallback","textarea","setTextarea","setPreview","actionName","buttonName","strict","triggerAction","detachCallback","clear","MarkdownNotepadState","eventKeyDown","eventContextMenu","getConfigurationDefault","setAttribute","initializeTabPane","ctrlKey","altKey","shiftKey","toLowerCase","filter","array","join","preventDefault","error","onMouseDown","onMouseUp","focusTextarea","focus","metadata","version"],"mappings":"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"}